<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SolBattles â€“ Stake. Battle. Earn.</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Custom Cursor and Trail Styles */
        body {
            cursor: none; /* Hide default cursor */
        }

        #custom-cursor {
            position: fixed;
            width: 25px; /* Bigger cursor */
            height: 25px; /* Bigger cursor */
            background-color: var(--highlight-color);
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
            transform: translate(-50%, -50%); /* Center the cursor */
            transition: width 0.1s ease-out, height 0.1s ease-out, background-color 0.1s ease-out;
            box-shadow: 0 0 20px var(--highlight-color), 0 0 40px var(--highlight-color); /* More glow */
        }

        .cursor-trail-particle {
            position: fixed;
            background-color: var(--glow-color); /* Light glow color */
            border-radius: 50%;
            pointer-events: none;
            opacity: 0.8; /* Increased opacity for more visibility */
            filter: blur(12px); /* Increased blur for bigger glow */
            animation: fadeOutTrail 2.5s forwards; /* Longer fade out duration */
            z-index: 9998;
            will-change: transform, opacity; /* Optimize for animation */
        }

        @keyframes fadeOutTrail {
            from {
                transform: scale(1);
                opacity: 0.8;
            }
            to {
                transform: scale(0);
                opacity: 0;
            }
        }


        /* Loading Screen Styles */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-bg) 0%, #0d121f 50%, var(--primary-bg) 100%); /* Futuristic gradient */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 1;
            transition: opacity 1.5s ease-out; /* Slower fade out */
            overflow: hidden; /* For scan line */
        }

        #loading-screen.fade-out {
            opacity: 0;
            pointer-events: none; /* Disable interaction during fade out */
        }

        .loading-title {
            font-family: 'Press Start 2P', cursive;
            color: var(--solana-green); /* Techy green */
            font-size: 3rem; /* Larger title */
            text-shadow: 0 0 15px var(--solana-green), 0 0 30px rgba(60, 230, 188, 0.5); /* Glowing title */
            margin-bottom: 30px;
            animation: textPulse 2s infinite alternate; /* Subtle pulse */
        }

        @keyframes textPulse {
            from { text-shadow: 0 0 10px var(--solana-green), 0 0 20px rgba(60, 230, 188, 0.3); }
            to { text-shadow: 0 0 20px var(--solana-green), 0 0 40px rgba(60, 230, 188, 0.7); }
        }

        .loading-spinner {
            border: 8px solid var(--secondary-bg);
            border-top: 8px solid var(--highlight-color);
            border-radius: 50%;
            width: 80px; /* Bigger spinner */
            height: 80px; /* Bigger spinner */
            animation: spin 1.8s linear infinite; /* Slower spin */
            margin-bottom: 30px;
            box-shadow: 0 0 15px var(--highlight-color), 0 0 25px var(--highlight-color) inset; /* Inner and outer glow */
        }

        .progress-bar-container {
            width: 70%;
            max-width: 500px;
            height: 15px;
            background-color: var(--secondary-bg);
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            margin-top: 20px;
            box-shadow: 0 0 10px var(--border-color) inset;
        }

        .progress-bar-fill {
            height: 100%;
            width: 0%; /* Will be animated by JS */
            background: linear-gradient(90deg, var(--solana-purple), var(--solana-blue));
            border-radius: 8px;
            transition: width 0.5s ease-out; /* Smooth fill */
            position: absolute;
            top: 0;
            left: 0;
        }

        .progress-bar-scan {
            position: absolute;
            top: 0;
            left: -20%; /* Start off screen */
            width: 20%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: scanLine 2s infinite linear; /* Scanning animation */
            border-radius: 8px;
            transform: skewX(-20deg); /* Slanted effect */
        }

        @keyframes scanLine {
            0% { left: -20%; }
            100% { left: 100%; }
        }

        .loading-text {
            font-family: 'Orbitron', sans-serif;
            color: var(--text-color);
            font-size: 1.1rem;
            margin-top: 20px;
            animation: flicker 1s infinite alternate; /* Subtle flicker */
        }

        @keyframes flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        /* General Styling */
        :root {
            --primary-bg: #1a1a2e;
            --secondary-bg: #16213e;
            --card-bg: #0f3460;
            --text-color: #e0e0e0;
            --highlight-color: #e94560;
            --button-bg: #533483;
            --button-hover: #e94560;
            --glow-color: #8a2be2; /* BlueViolet */
            --border-color: #0c7b93;
            --dark-border: #0a1128;
            --solana-purple: #925FE2;
            --solana-blue: #4DCFFD;
            --solana-green: #3CE6BC;
        }

        html {
            font-size: 16px; /* Base font size for rem units */
        }

        body {
            font-family: 'Orbitron', sans-serif;
            background-color: var(--primary-bg);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            line-height: 1.6;
            overflow-x: hidden; /* Prevent horizontal scroll on some animations */
            position: relative; /* For pseudo-elements / particles */
            font-size: 1rem; /* Base font size for body */
        }

        /* Subtle background particles/glows */
        body::before, body::after {
            content: '';
            position: absolute;
            width: 150px;
            height: 150px;
            background: radial-gradient(circle, var(--solana-purple) 0%, transparent 70%);
            border-radius: 50%;
            opacity: 0.1;
            filter: blur(50px);
            animation: moveLight1 15s infinite alternate;
            z-index: -1;
        }

        body::after {
            width: 120px;
            height: 120px;
            background: radial-gradient(circle, var(--solana-blue) 0%, transparent 70%);
            animation: moveLight2 20s infinite alternate;
        }

        @keyframes moveLight1 {
            0% { top: 10%; left: 10%; }
            50% { top: 80%; left: 70%; }
            100% { top: 10%; left: 10%; }
        }

        @keyframes moveLight2 {
            0% { top: 80%; left: 20%; }
            50% { top: 10%; left: 80%; }
            100% { top: 80%; left: 20%; }
        }


        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px 10px; /* Adjusted padding for better small screen view */
            box-sizing: border-box; /* Include padding in element's total width */
        }

        h1, h2, h3 {
            font-family: 'Press Start 2P', cursive;
            color: var(--highlight-color);
            text-align: center;
            margin-bottom: 1.25rem; /* Converted to rem */
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.7);
        }

        p, ul {
            font-family: 'Orbitron', sans-serif;
            margin-bottom: 0.625rem; /* Converted to rem */
        }

        a {
            color: var(--highlight-color);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        a:hover {
            color: var(--glow-color);
        }

        /* Header */
        header {
            background-color: var(--secondary-bg);
            padding: 0.9375rem 0; /* Converted to rem */
            border-bottom: 2px solid var(--border-color);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
            position: sticky;
            top: 0;
            z-index: 1000;
            overflow: hidden; /* Ensure pseudo-elements don't overflow */
        }
        /* New Animated Background for Header */
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(138, 43, 226, 0.1), rgba(77, 207, 253, 0.1));
            background-size: 200% 200%;
            animation: gradientShift 25s ease infinite alternate; /* Slower animation */
            z-index: -1;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 0%; }
            100% { background-position: 100% 100%; }
        }


        header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
        }

        header h1 {
            margin: 0;
            font-size: 1.8rem; /* Converted to rem */
            white-space: nowrap; /* Prevent breaking on small screens */
        }

        nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-wrap: wrap; /* Allow nav items to wrap */
            justify-content: center;
        }

        nav li {
            margin: 0 0.9375rem; /* Converted to rem */
        }

        nav a {
            color: var(--text-color);
            font-weight: bold;
            padding: 0.3125rem 0; /* Converted to rem */
            position: relative;
            transition: color 0.3s ease, transform 0.3s ease;
        }

        nav a::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            background: var(--highlight-color);
            left: 0;
            bottom: -0.3125rem; /* Converted to rem */
            transition: width 0.3s ease;
        }

        nav a:hover::after,
        nav a.active::after {
            width: 100%;
        }

        nav a:hover {
            color: var(--highlight-color);
            transform: translateY(-2px);
        }

        .glow-button {
            background-color: var(--button-bg);
            color: var(--text-color);
            border: none;
            padding: 0.625rem 1.25rem; /* Converted to rem */
            border-radius: 5px;
            cursor: pointer; /* Use default cursor for buttons */
            font-family: 'Press Start 2P', cursive;
            font-size: 0.9rem; /* Converted to rem */
            text-transform: uppercase;
            box-shadow: 0 0 10px var(--glow-color);
            transition: all 0.3s ease;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
        }

        .glow-button:hover {
            background-color: var(--button-hover);
            box-shadow: 0 0 15px var(--glow-color), 0 0 30px var(--glow-color);
            transform: scale(1.05);
        }

        .glow-button:disabled {
            background-color: #333;
            box-shadow: none;
            cursor: not-allowed;
            opacity: 0.6;
            transform: none;
        }

        /* Wallet Status Display */
        #walletStatus {
            display: flex;
            align-items: center;
            font-size: 0.9rem; /* Converted to rem */
            color: var(--text-color);
            margin-left: 1.25rem; /* Converted to rem */
            flex-wrap: wrap;
            justify-content: center;
        }

        #walletStatus.connected .status-dot {
            background-color: var(--solana-green);
            box-shadow: 0 0 8px var(--solana-green);
        }

        #walletStatus.connecting .status-dot {
            background-color: orange;
            animation: pulse 1s infinite alternate;
        }

        .status-dot {
            width: 0.625rem; /* Converted to rem */
            height: 0.625rem; /* Converted to rem */
            border-radius: 50%;
            background-color: grey;
            margin-right: 0.5rem; /* Converted to rem */
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }
        #walletAddress {
            font-family: 'Press Start 2P', cursive;
            font-size: 0.8rem; /* Converted to rem */
            margin-left: 0.625rem; /* Converted to rem */
            color: var(--solana-blue);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 9.375rem; /* Converted to rem */ /* Limit width */
        }
        #slugBalanceDisplay {
            margin-left: 0.9375rem; /* Converted to rem */
            font-weight: bold;
            color: var(--solana-green);
            white-space: nowrap;
        }


        /* Main Content Sections */
        main {
            padding: 1.25rem 0; /* Converted to rem */
            width: 100%; /* Ensure main takes full width for section alignment */
        }

        .page {
            display: none;
            padding: 2.5rem 0; /* Converted to rem */
            /* Removed direct fadeIn for pages, handled by JS with section-animate-in */
            width: 100%; /* Ensure page takes full width */
        }

        .page.active {
            display: block;
        }

        /* General Section Animation */
        .section-animate-in {
            opacity: 0;
            transform: translateY(40px) scale(0.98);
            transition: opacity 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94); /* Slower transition */
        }

        .section-animate-in.visible {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        /* Text Specific Animation */
        .text-animate-in {
            opacity: 0;
            transform: translateY(15px);
            transition: opacity 0.8s ease-out, transform 0.8s ease-out; /* Slower transition */
        }

        .text-animate-in.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Homepage */
        .hero {
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('https://via.placeholder.com/1200x400/0f3460/e0e0e0?text=SOLBATTLES+ARENA') no-repeat center center/cover; /* Placeholder for hero_bg.png */
            padding: 5rem 1.25rem; /* Converted to rem */
            text-align: center;
            border-radius: 10px;
            margin-bottom: 2.5rem; /* Converted to rem */
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.8);
            animation: heroGlow 2s infinite alternate;
            background-attachment: fixed; /* For parallax effect */
            background-position: center 0; /* Initial position for parallax */
        }

        @keyframes heroGlow {
            from { box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.8), 0 0 10px rgba(138, 43, 226, 0.3); }
            to { box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.9), 0 0 20px rgba(138, 43, 226, 0.7); }
        }

        .hero h2 {
            font-size: 3rem; /* Converted to rem */
            margin-bottom: 0.625rem; /* Converted to rem */
            color: var(--text-color);
            text-shadow: 3px 3px 7px var(--highlight-color);
            animation: textFadeInUp 1.5s cubic-bezier(0.23, 1, 0.32, 1) forwards; /* Slower animation */
            opacity: 0; /* Start hidden */
        }

        .hero p {
            font-size: 1.2rem; /* Converted to rem */
            max-width: 43.75rem; /* Converted to rem */
            margin: 0 auto;
            color: #ccc;
            animation: textFadeInUp 1.5s cubic-bezier(0.23, 1, 0.32, 1) forwards 0.3s; /* Delayed animation, slower */
            opacity: 0; /* Start hidden */
        }

        @keyframes textFadeInUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Individual Section Styles - now inheriting .section-animate-in */
        .about-section {
            /* Inherits animation from .section-animate-in */
        }
        .roadmap-section {
            /* Inherits animation from .section-animate-in */
        }
        .docs-section {
            /* Inherits animation from .section-animate-in */
            text-align: center; /* Override default text-align */
        }
        .token-info {
            /* Inherits animation from .section-animate-in */
        }
        .leaderboard-table-container {
            /* Inherits animation from .section-animate-in */
        }
        .arena-setup {
            /* Inherits animation from .section-animate-in */
        }
        .battle-results-box {
            /* Inherits animation from .section-animate-in */
        }
        .shop-pack-section {
            /* Inherits animation from .section-animate-in */
        }

        /* Game Features Section */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-top: 40px;
            padding-bottom: 40px;
            text-align: center;
        }

        .feature-item {
            background-color: var(--card-bg);
            padding: 25px;
            border-radius: 10px;
            border: 2px solid var(--border-color);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.6);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            opacity: 0; /* Hidden by default for scroll animation */
            transform: scale(0.8); /* Start smaller */
            transition: opacity 1s cubic-bezier(0.175, 0.885, 0.32, 1.275), transform 1s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Slower Springy effect */
        }

        .feature-item.visible {
            opacity: 1;
            transform: scale(1);
        }
        /* Stagger feature item animations handled by JS now */


        .feature-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 25px var(--glow-color);
        }

        .feature-item svg {
            width: 50px;
            height: 50px;
            margin-bottom: 15px;
            fill: var(--highlight-color);
            transition: fill 0.3s ease;
        }

        .feature-item:hover svg {
            fill: var(--text-color);
        }

        .feature-item h4 {
            font-family: 'Press Start 2P', cursive;
            color: var(--text-color);
            font-size: 1.1rem;
            margin-top: 0;
            margin-bottom: 10px;
        }

        .feature-item p {
            font-size: 0.9rem;
            color: #ccc;
        }


        /* Roadmap Section */
        .roadmap-timeline {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 30px;
        }

        .roadmap-phase {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            border-left: 5px solid var(--highlight-color);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.4);
            position: relative;
            opacity: 0; /* Hidden by default for scroll animation */
            transform: translateX(-50px); /* Initial offset for slide-in */
            transition: opacity 1s ease-out, transform 1s ease-out; /* Slower transition */
        }
        .roadmap-phase.visible {
            opacity: 1;
            transform: translateX(0);
        }
        .roadmap-phase:nth-child(odd).visible {
            border-left-color: var(--solana-green);
        }
        .roadmap-phase:nth-child(even) {
            transform: translateX(50px); /* Start from right for even phases */
        }
        .roadmap-phase:nth-child(even).visible {
            border-left-color: var(--solana-blue);
            transform: translateX(0); /* Ensure it slides in from right for even */
        }

        .roadmap-phase h4 {
            font-family: 'Press Start 2P', cursive;
            color: var(--text-color);
            font-size: 1.2rem;
            margin-top: 0;
            margin-bottom: 10px;
        }

        .roadmap-phase ul {
            list-style: disc inside;
            margin-left: 15px;
            color: #ccc;
        }

        .roadmap-phase ul li {
            margin-bottom: 5px;
        }


        /* Docs Section */
        .docs-section p {
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .docs-section .glow-button {
            display: inline-block;
            margin-top: 10px;
        }

        /* Card Styling (Reusable) */
        .card {
            background-color: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 10px;
            padding: 0.9375rem; /* Converted to rem */
            text-align: center;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.6);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .card:hover {
            transform: translateY(-0.3125rem); /* Converted to rem */
            box-shadow: 0 0 25px var(--glow-color);
        }

        .card.selected {
            border-color: var(--glow-color);
            box-shadow: 0 0 30px var(--glow-color), 0 0 10px var(--highlight-color);
            transform: translateY(-0.5rem); /* Converted to rem */
        }

        .card img {
            width: 100%;
            max-width: 11.25rem; /* Converted to rem */
            height: auto;
            border-radius: 8px;
            margin-bottom: 0.625rem; /* Converted to rem */
            border: 1px solid var(--dark-border);
            object-fit: cover;
        }

        .card h4 {
            margin: 0.625rem 0; /* Converted to rem */
            color: var(--highlight-color);
            font-family: 'Press Start 2P', cursive;
            font-size: 1.1rem; /* Converted to rem */
        }

        .card p {
            font-size: 0.9rem;
            margin: 0.3125rem 0; /* Converted to rem */
        }

        .card-stats {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.3125rem; /* Converted to rem */
            margin-top: 0.625rem; /* Converted to rem */
            font-size: 0.8rem; /* Converted to rem */
        }

        .card-stat {
            background-color: rgba(0, 0, 0, 0.3);
            padding: 0.1875rem 0.5rem; /* Converted to rem */
            border-radius: 3px;
            white-space: nowrap;
        }

        .rarity {
            font-weight: bold;
            text-transform: uppercase;
            margin-top: 0.3125rem; /* Converted to rem */
        }
        .rarity.common { color: #aaa; }
        .rarity.rare { color: #00bfff; } /* Deep Sky Blue */
        .rarity.epic { color: #8a2be2; } /* Blue Violet */
        .rarity.legendary { color: #ffd700; } /* Gold */


        /* Grids */
        .card-grid, .shop-grid, .my-deck-grid, .revealed-cards-grid, .card-selection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(12.5rem, 1fr)); /* Converted to rem */
            gap: 1.25rem; /* Converted to rem */
            padding: 1.25rem 0; /* Converted to rem */
        }

        /* Arena Page */
        .arena-setup {
            text-align: center;
        }

        .wallet-stake-input {
            margin-bottom: 1.25rem; /* Converted to rem */
            font-size: 1.1rem; /* Converted to rem */
        }

        .wallet-stake-input input {
            width: 6.25rem; /* Converted to rem */
            padding: 0.5rem; /* Converted to rem */
            border-radius: 5px;
            border: 1px solid var(--border-color);
            background-color: var(--card-bg);
            color: var(--text-color);
            font-family: 'Orbitron', sans-serif;
            margin-left: 0.625rem; /* Converted to rem */
        }

        .card-selection-grid .card {
            cursor: pointer;
        }

        .battle-results-box {
            text-align: center;
        }

        .battle-log {
            background-color: var(--card-bg);
            border: 1px solid var(--dark-border);
            border-radius: 8px;
            padding: 0.9375rem; /* Converted to rem */
            max-height: 15.625rem; /* Converted to rem */
            overflow-y: auto;
            text-align: left;
            margin-bottom: 1.25rem; /* Converted to rem */
            font-size: 0.9rem; /* Converted to rem */
            line-height: 1.8;
            scrollbar-width: thin; /* Firefox */
            scrollbar-color: var(--highlight-color) var(--card-bg); /* Firefox */
        }
        /* Custom scrollbar for Webkit browsers */
        .battle-log::-webkit-scrollbar {
            width: 8px;
        }

        .battle-log::-webkit-scrollbar-track {
            background: var(--card-bg);
            border-radius: 10px;
        }

        .battle-log::-webkit-scrollbar-thumb {
            background-color: var(--highlight-color);
            border-radius: 10px;
            border: 2px solid var(--card-bg);
        }


        .battle-log p {
            margin-bottom: 0.3125rem; /* Converted to rem */
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-1.25rem); } /* Converted to rem */
            to { opacity: 1; transform: translateX(0); }
        }

        .battle-log p:nth-child(even) {
            color: #ccc;
        }
        .battle-log p strong {
            color: var(--highlight-color);
        }
        .battle-log p.winner-message {
            color: #4CAF50; /* Green */
            font-weight: bold;
        }
        .battle-log p.loser-message {
            color: #F44336; /* Red */
            font-weight: bold;
        }

        #battleWinner {
            color: #4CAF50;
            font-size: 1.8rem; /* Converted to rem */
            margin-bottom: 0.3125rem; /* Converted to rem */
            animation: winnerGlow 1s infinite alternate;
        }

        #battleLoser {
            color: #F44336;
            font-size: 1.2rem; /* Converted to rem */
        }

        @keyframes winnerGlow {
            from { text-shadow: 0 0 5px #4CAF50; }
            to { text-shadow: 0 0 15px #4CAF50, 0 0 30px #4CAF50; }
        }


        /* Shop Page specific styles for pack opening */
        .shop-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center; /* Center horizontally */
        }

        .shop-pack-section {
            text-align: center;
            width: 100%;
            box-sizing: border-box; /* Include padding in width calculation */
        }

        #packOpeningAnimation {
            text-align: center;
            margin-top: 1.875rem; /* Converted to rem */
            padding: 1.875rem; /* Converted to rem */
            background-color: var(--secondary-bg);
            border-radius: 10px;
            border: 1px solid var(--border-color);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .pack-image {
            width: 12.5rem; /* Converted to rem */
            height: 12.5rem; /* Converted to rem */
            object-fit: contain;
            animation: bounce 1s infinite alternate;
            filter: drop-shadow(0 0 10px var(--glow-color));
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-0.9375rem); } /* Converted to rem */
        }

        .reveal-message {
            font-size: 1.5rem; /* Converted to rem */
            margin-top: 1.25rem; /* Converted to rem */
            color: var(--text-color);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .revealed-cards-grid .card {
            animation: cardFlip 0.8s ease-out forwards;
            transform-style: preserve-3d;
            perspective: 1000px;
        }

        .card-flip-container {
            position: relative;
            width: 12.5rem; /* Converted to rem */ /* Adjust based on your card size */
            height: 18.75rem; /* Converted to rem */ /* Adjust based on your card size */
            transform-style: preserve-3d;
            transition: transform 0.8s;
            margin: 0 auto; /* Center individual card flips */
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            padding: 0.9375rem; /* Converted to rem */
            box-sizing: border-box;
            border: 2px solid var(--border-color);
            background-color: var(--card-bg);
        }

        .card-front {
            z-index: 2;
            transform: rotateY(0deg);
        }

        .card-front img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }

        .card-back {
            background-color: var(--button-bg);
            border: 2px solid var(--glow-color);
            transform: rotateY(180deg);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem; /* Converted to rem */
            color: var(--text-color);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.6);
        }

        .card-back::before {
            content: "SLUG";
            font-family: 'Press Start 2P', cursive;
            opacity: 0.2;
            font-size: 3rem; /* Converted to rem */
            position: absolute;
            z-index: 1;
        }
         .card-back img { /* Styling for image on the flipped card back */
            max-width: 11.25rem; /* Converted to rem */
            height: auto;
            border-radius: 8px;
            margin-bottom: 0.625rem; /* Converted to rem */
            border: 1px solid var(--dark-border);
            object-fit: cover;
            z-index: 2; /* Ensure image is above pseudo-element */
        }
        .card-back h4, .card-back p, .card-back .card-stats {
            z-index: 2; /* Ensure text is above pseudo-element */
        }


        /* Shop Page */
        .shop-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(12.5rem, 1fr)); /* Converted to rem */
            gap: 1.25rem; /* Converted to rem */
            padding: 1.25rem 0; /* Converted to rem */
            width: 100%; /* Ensure it takes full width within shop-content */
        }

        .shop-grid .card .buy-button {
            margin-top: 0.9375rem; /* Converted to rem */
            width: calc(100% - 1.875rem); /* Adjusted for padding */ /* Converted to rem */
            bottom: 0.9375rem; /* Converted to rem */
            left: 0.9375rem; /* Converted to rem */
            position: relative; /* Changed to relative as it's inside a flex column */
        }
        .shop-grid .card {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }


        /* My Deck Page */
        .deck-controls {
            text-align: right;
            margin-bottom: 1.25rem; /* Converted to rem */
        }

        .deck-controls label {
            margin-right: 0.625rem; /* Converted to rem */
            font-size: 1.1rem; /* Converted to rem */
        }

        .deck-controls select {
            padding: 0.5rem; /* Converted to rem */
            border-radius: 5px;
            border: 1px solid var(--border-color);
            background-color: var(--card-bg);
            color: var(--text-color);
            font-family: 'Orbitron', sans-serif;
            min-width: 9.375rem; /* Converted to rem */
        }

        .my-deck-grid .card {
            cursor: pointer;
        }

        .card-detail-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .card-detail-content {
            background-color: var(--secondary-bg);
            padding: 1.875rem; /* Converted to rem */
            border-radius: 10px;
            border: 2px solid var(--glow-color);
            box-shadow: 0 0 20px var(--glow-color);
            text-align: center;
            max-width: 25rem; /* Converted to rem */
            width: 90%;
            position: relative;
            animation: popIn 0.3s ease-out;
        }

        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .card-detail-content .close-popup {
            position: absolute;
            top: 0.625rem; /* Converted to rem */
            right: 0.9375rem; /* Converted to rem */
            font-size: 1.8rem; /* Converted to rem */
            cursor: pointer;
            color: var(--text-color);
        }

        .card-detail-content .close-popup:hover {
            color: var(--highlight-color);
        }

        .card-detail-content img {
            max-width: 12.5rem; /* Converted to rem */
            border-radius: 8px;
            margin-bottom: 0.9375rem; /* Converted to rem */
            border: 1px solid var(--dark-border);
        }

        .card-detail-content h3 {
            margin-top: 0;
            font-size: 1.5rem; /* Converted to rem */
        }

        .card-detail-content p {
            font-size: 1rem; /* Converted to rem */
            margin: 0.3125rem 0; /* Converted to rem */
        }

        .card-actions {
            margin-top: 1.25rem; /* Converted to rem */
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 0.625rem; /* Converted to rem */
        }


        /* Leaderboard Page */
        .leaderboard-table-container {
            overflow-x: auto; /* Enable horizontal scroll on small screens */
        }

        #leaderboardTable {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1.25rem; /* Converted to rem */
            white-space: nowrap; /* Keep table cells on one line */
        }

        #leaderboardTable th, #leaderboardTable td {
            padding: 0.75rem 0.9375rem; /* Converted to rem */
            text-align: left;
            border-bottom: 1px solid var(--dark-border);
            transition: background-color 0.2s ease;
        }

        #leaderboardTable th {
            background-color: var(--card-bg);
            color: var(--highlight-color);
            font-family: 'Press Start 2P', cursive;
            font-size: 0.8rem; /* Converted to rem */
            text-transform: uppercase;
        }

        #leaderboardTable tbody tr:nth-child(even) {
            background-color: rgba(0, 0, 0, 0.2);
        }

        #leaderboardTable tbody tr:hover {
            background-color: rgba(0, 0, 0, 0.4);
            transform: scale(1.01);
            transition: all 0.2s ease;
        }

        #leaderboardTable tbody tr {
            animation: fadeInRow 0.5s ease-out;
        }

        @keyframes fadeInRow {
            from { opacity: 0; transform: translateY(0.625rem); } /* Converted to rem */
            to { opacity: 1; transform: translateY(0); }
        }

        .leaderboard-table-container .rank-change {
            display: inline-block;
            margin-left: 0.3125rem; /* Converted to rem */
            font-size: 0.8rem; /* Converted to rem */
            font-weight: bold;
            opacity: 0;
            transform: translateY(0.625rem); /* Converted to rem */
            animation: rankChangeEffect 0.5s forwards;
        }

        .rank-change.up { color: var(--solana-green); }
        .rank-change.down { color: #F44336; }
        .rank-change.new { color: var(--solana-blue); }

        @keyframes rankChangeEffect {
            from { opacity: 0; transform: translateY(0.625rem); }
            to { opacity: 1; transform: translateY(0); }
        }

        .weekly-update-note {
            text-align: center;
            font-style: italic;
            color: #aaa;
            margin-top: 1.25rem; /* Converted to rem */
        }

        /* Token Page */
        .token-info ul {
            list-style: disc inside;
            margin-left: 1.25rem; /* Converted to rem */
            margin-bottom: 1.25rem; /* Converted to rem */
        }

        .token-info ul li {
            margin-bottom: 0.5rem; /* Converted to rem */
        }

        .token-info p {
            margin-bottom: 0.625rem; /* Converted to rem */
        }

        .token-actions {
            text-align: center;
            margin-top: 1.875rem; /* Converted to rem */
            display: flex;
            justify-content: center;
            gap: 1.25rem; /* Converted to rem */
            flex-wrap: wrap;
        }

        .coming-soon-badge {
            display: inline-block;
            background-color: var(--solana-purple);
            color: white;
            padding: 0.25rem 0.5rem; /* Converted to rem */
            border-radius: 5px;
            font-size: 0.7rem; /* Converted to rem */
            margin-left: 0.625rem; /* Converted to rem */
            animation: pulse 1s infinite alternate;
        }


        /* Footer */
        footer {
            background-color: var(--secondary-bg);
            padding: 1.25rem 0; /* Converted to rem */
            text-align: center;
            border-top: 2px solid var(--border-color);
            margin-top: 2.5rem; /* Converted to rem */
            box-shadow: 0 -4px 8px rgba(0, 0, 0, 0.4);
        }

        footer p {
            margin: 0;
            color: #aaa;
            font-size: 0.9rem; /* Converted to rem */
        }

        /* Universal Popup */
        .universal-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
        }

        .universal-popup-content {
            background-color: var(--secondary-bg);
            padding: 2.5rem; /* Converted to rem */
            border-radius: 10px;
            border: 2px solid var(--highlight-color);
            box-shadow: 0 0 25px var(--glow-color);
            text-align: center;
            max-width: 28.125rem; /* Converted to rem */
            width: 90%;
            position: relative;
            animation: popIn 0.3s ease-out;
        }

        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .universal-popup-content .close-universal-popup {
            position: absolute;
            top: 0.625rem; /* Converted to rem */
            right: 0.9375rem; /* Converted to rem */
            font-size: 1.8rem; /* Converted to rem */
            cursor: pointer;
            color: var(--text-color);
        }

        .universal-popup-content .close-universal-popup:hover {
            color: var(--highlight-color);
        }

        .universal-popup-content p {
            font-size: 1.2rem; /* Converted to rem */
            margin-bottom: 1.5625rem; /* Converted to rem */
            color: var(--text-color);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            html {
                font-size: 14px; /* Adjust base font size for tablets */
            }
            header .container {
                flex-direction: column;
                text-align: center;
            }

            header h1 {
                margin-bottom: 0.9375rem; /* Converted to rem */
                font-size: 1.5rem; /* Converted to rem */
            }

            nav ul {
                margin-top: 0.9375rem; /* Converted to rem */
                margin-bottom: 0.9375rem; /* Converted to rem */
            }

            nav li {
                margin: 0 0.5rem; /* Converted to rem */
            }

            .hero h2 {
                font-size: 2.2rem; /* Converted to rem */
            }

            .hero p {
                font-size: 1rem; /* Converted to rem */
            }

            .card-grid, .shop-grid, .my-deck-grid, .revealed-cards-grid, .card-selection-grid {
                grid-template-columns: repeat(auto-fit, minmax(9.375rem, 1fr)); /* Converted to rem */
            }

            .card img {
                max-width: 7.5rem; /* Converted to rem */
            }

            .arena-setup, .battle-results-box, .shop-pack-section {
                padding: 1.25rem; /* Converted to rem */
            }

            .leaderboard-table-container {
                padding: 0.625rem; /* Converted to rem */
            }

            #leaderboardTable th, #leaderboardTable td {
                padding: 0.5rem 0.625rem; /* Converted to rem */
                font-size: 0.8rem; /* Converted to rem */
            }

            .card-detail-content, .universal-popup-content {
                padding: 1.5625rem; /* Converted to rem */
            }
            #walletAddress {
                max-width: 6.25rem; /* Converted to rem */
                font-size: 0.7rem; /* Converted to rem */
            }
            #slugBalanceDisplay {
                margin-top: 0.3125rem; /* Converted to rem */
                margin-left: 0;
            }
        }

        @media (max-width: 480px) {
            html {
                font-size: 12px; /* Further adjust base font size for mobile */
            }
            header h1 {
                font-size: 1.2rem; /* Converted to rem */
            }

            nav ul {
                flex-direction: column;
                align-items: center;
            }

            nav li {
                margin: 0.5rem 0; /* Converted to rem */
            }

            .hero {
                padding: 3.125rem 0.625rem; /* Converted to rem */
            }

            .hero h2 {
                font-size: 1.8rem; /* Converted to rem */
            }

            .glow-button {
                padding: 0.5rem 0.9375rem; /* Converted to rem */
                font-size: 0.8rem; /* Converted to rem */
            }

            .card-grid, .shop-grid, .my-deck-grid, .revealed-cards-grid, .card-selection-grid {
                grid-template-columns: repeat(auto-fit, minmax(7.5rem, 1fr)); /* Converted to rem */
            }

            .card h4 {
                font-size: 0.9rem; /* Converted to rem */
            }

            .card p, .card-stats {
                font-size: 0.75rem; /* Converted to rem */
            }

            .wallet-stake-input label, .deck-controls label {
                font-size: 1rem; /* Converted to rem */
                display: block;
                margin-bottom: 0.3125rem; /* Converted to rem */
            }

            .wallet-stake-input input, .deck-controls select {
                width: calc(100% - 1.25rem); /* Converted to rem */
                max-width: 9.375rem; /* Converted to rem */
            }

            .token-actions {
                flex-direction: column;
                gap: 0.9375rem; /* Converted to rem */
            }
        }
    </style>
</head>
<body>
    <!-- Custom Cursor Element -->
    <div id="custom-cursor"></div>
    <!-- Container for Cursor Trail Particles -->
    <div id="cursorTrailContainer"></div>

    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loading-title">SOLBATTLES</div>
        <div class="loading-spinner"></div>
        <div class="progress-bar-container">
            <div class="progress-bar-fill" id="loading-progress-fill"></div>
            <div class="progress-bar-scan"></div>
        </div>
        <div class="loading-text" id="loading-message">Initializing modules...</div>
    </div>

    <header>
        <div class="container">
            <h1>SolBattles</h1>
            <nav>
                <ul>
                    <li><a href="#home" class="nav-link active" data-page="home">Home</a></li>
                    <li><a href="#arena" class="nav-link" data-page="arena">Arena</a></li>
                    <li><a href="#shop" class="nav-link" data-page="shop">Shop</a></li> <!-- Combined Shop & Card Packs -->
                    <li><a href="#my-deck" class="nav-link" data-page="my-deck">My Deck</a></li>
                    <li><a href="#leaderboard" class="nav-link" data-page="leaderboard">Leaderboard</a></li>
                    <li><a href="#token" class="nav-link" data-page="token">Token ($SLUG)</a></li>
                    <li><a href="#docs" class="nav-link" data-page="docs">Docs</a></li>
                </ul>
            </nav>
            <button id="connectWalletBtn" class="glow-button">Connect Wallet</button>
            <div id="walletStatus" style="display: none;">
                <span class="status-dot"></span>
                <span id="walletConnectionText">Not Connected</span>
                <span id="walletAddress"></span>
                <span id="slugBalanceDisplay"></span>
            </div>
        </div>
    </header>

    <main>
        <!-- Homepage Section -->
        <section id="home" class="page active">
            <div class="container">
                <div class="hero" id="homeHero">
                    <h2>Stake. Battle. Earn.</h2>
                    <p>Enter the SolBattles Arena and prove your might! Collect powerful NFT cards, strategically build your deck, and compete on the leaderboard for glory and $SLUG rewards.</p>
                </div>

                <div class="about-section section-animate-in">
                    <h3>About SolBattles</h3>
                    <p class="text-animate-in">SolBattles is a groundbreaking decentralized battle card game built on the Solana blockchain. Experience fast-paced, strategic card battles where your NFT-style character cards come to life. Stake $SLUG, outwit your opponents, and climb the ranks to become a SolBattles legend!</p>

                    <h3 class="text-animate-in">$SLUG: The Heart of the Ecosystem</h3>
                    <p class="text-animate-in">The $SLUG token is the native utility token of SolBattles. It's essential for acquiring powerful NFT-style character cards, upgrading your existing collection, and participating in high-stakes battles against other players. Every $SLUG spent fuels the SolBattles ecosystem, creating a vibrant and rewarding experience.</p>

                    <h3 class="text-animate-in">NFT Character Cards: Own Your Power</h3>
                    <p class="text-animate-in">Collect unique and powerful NFT-style character cards, each with distinct stats (Attack, Defense, Speed, Luck) and rarities (Common, Rare, Epic, Legendary). These aren't just pretty pictures; they're your warriors in the arena, verifiable on the blockchain. Build a diverse and unbeatable deck to dominate your opponents.</p>
                </div>

                <div class="roadmap-section section-animate-in">
                    <h3>Game Features</h3>
                    <div class="features-grid">
                        <div class="feature-item">
                            <!-- Icon for Decentralized Battles -->
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93s3.05-7.44 7-7.93V3.07c-4.52.49-8 4.31-8 9s3.48 8.51 8 9.01v-1.08zm2-17.93v1.08c3.95.49 7 3.85 7 7.93s-3.05 7.44-7 7.93v1.08c4.52-.49 8-4.31 8-9s-3.48-8.51-8-9.01zM11 15h2v2h-2zm0-4h2v3h-2zm0-4h2v2h-2z"/></svg>
                            <h4 class="text-animate-in">Decentralized Battles</h4>
                            <p class="text-animate-in">Experience fair and transparent gameplay. All battle outcomes are verifiable on the blockchain.</p>
                        </div>
                        <div class="feature-item">
                            <!-- Icon for NFT Ownership -->
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 2.23L18.15 5.5 12 10.45 5.85 5.5 12 3.23zM4 6.32l7 3.5v11.23c-4.47-1.74-7-6.02-7-10.73V6.32zm16 0V11c0 4.71-2.53 8.99-7 10.73V9.82l7-3.5z"/></svg>
                            <h4 class="text-animate-in">True NFT Ownership</h4>
                            <p class="text-animate-in">Your cards are real digital assets. Collect, trade, and truly own your in-game power.</p>
                        </div>
                        <div class="feature-item">
                            <!-- Icon for Dynamic Leaderboards -->
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16 11V3H8v8H2v10h20V11h-6zM10 5h4v6h-4V5zm10 14h-8v-6h8v6zM4 15h6v4H4v-4z"/></svg>
                            <h4 class="text-animate-in">Dynamic Leaderboards</h4>
                            <p class="text-animate-in">Compete globally and see your progress updated in real-time. Dominate the ranks!</p>
                        </div>
                        <div class="feature-item">
                            <!-- Icon for Token Utility -->
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 6h-4V4c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2 2v2H4c-1.11 0-2 .89-2 2v10c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-6-2h-4v2h4V4zm6 14H4V8h16v10zM12 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
                            <h4 class="text-animate-in">Full $SLUG Utility</h4>
                            <p class="text-animate-in">$SLUG powers every aspect of the game, from card acquisition to high-stakes battles.</p>
                        </div>
                    </div>
                </div>

                <div class="roadmap-section section-animate-in">
                    <h3>Roadmap</h3>
                    <div class="roadmap-timeline">
                        <div class="roadmap-phase">
                            <h4 class="text-animate-in">Phase 1: Launch & Core Gameplay</h4>
                            <ul>
                                <li class="text-animate-in">Website Launch (Current)</li>
                                <li class="text-animate-in">Core Battle Engine Implementation</li>
                                <li class="text-animate-in">NFT Card Generation & Marketplace Integration</li>
                                <li class="text-animate-in">Basic Leaderboard System</li>
                            </ul>
                        </div>
                        <div class="roadmap-phase">
                            <h4 class="text-animate-in">Phase 2: Ecosystem Expansion</h4>
                            <ul>
                                <li class="text-animate-in">Card Upgrading & Fusion Mechanics</li>
                                <li class="text-animate-in">Staking $SLUG for Rewards</li>
                                <li class="text-animate-in">Community Governance Features</li>
                                <li class="text-animate-in">Mobile App Development (Beta)</li>
                            </ul>
                        </div>
                        <div class="roadmap-phase">
                            <h4 class="text-animate-in">Phase 3: Advanced Features & Partnerships</h4>
                            <ul>
                                <li class="text-animate-in">Seasonal Tournaments & Exclusive Rewards</li>
                                <li class="text-animate-in">Player-vs-Environment (PvE) Modes</li>
                                <li class="text-animate-in">Cross-Chain Compatibility (Exploration)</li>
                                <li class="text-animate-in">Major Partnerships & Collaborations</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Battle Arena Page -->
        <section id="arena" class="page">
            <div class="container">
                <h2>Battle Arena</h2>
                <div class="arena-setup section-animate-in">
                    <div class="wallet-stake-input text-animate-in">
                        <label for="slugStake">SLUG Stake:</label>
                        <input type="number" id="slugStake" value="100" step="10" min="10">
                        <span>(Your Balance: <span id="mockSlugWalletBalance"></span> $SLUG)</span>
                    </div>
                    <h3 class="text-animate-in">Select 3 Cards for Battle:</h3>
                    <div id="battleCardSelection" class="card-selection-grid">
                        <!-- Cards from My Deck will be loaded here -->
                    </div>
                    <button id="startBattleBtn" class="glow-button">Start Battle</button>
                </div>

                <div id="battleResults" class="battle-results-box section-animate-in" style="display: none;">
                    <h3 class="text-animate-in">Battle Log</h3>
                    <div id="battleLog" class="battle-log">
                        <!-- Battle turn-by-turn log will appear here -->
                    </div>
                    <h3 id="battleWinner" class="text-animate-in"></h3>
                    <p id="battleLoser" class="text-animate-in"></p>
                    <button id="resetBattleBtn" class="glow-button">New Battle</button>
                </div>
            </div>
        </section>

        <!-- Shop Page -->
        <section id="shop" class="page">
            <div class="container">
                <h2>Shop</h2>
                <div class="shop-content">
                    <div class="shop-pack-section section-animate-in">
                        <h3 class="text-animate-in">Open Card Packs</h3>
                        <p class="text-animate-in">Discover new and powerful cards by opening a card pack!</p>
                        <button id="openPackBtn" class="glow-button">Open Pack (50 $SLUG)</button>
                        <div id="packOpeningAnimation" class="pack-opening-animation" style="display: none;">
                            <img src="https://via.placeholder.com/200x200/533483/e0e0e0?text=PACK" alt="Card Pack" onerror="this.onerror=null;this.src='https://via.placeholder.com/200x200/333333/FFFFFF?text=IMG+ERROR';">
                            <div class="reveal-message">Opening Pack...</div>
                        </div>
                        <div id="revealedCards" class="revealed-cards-grid">
                            <!-- Revealed cards will appear here -->
                        </div>
                    </div>

                    <h3 class="text-animate-in">Available Cards</h3>
                    <div id="shopGrid" class="shop-grid">
                        <!-- Shop items will be loaded here by JavaScript -->
                    </div>
                </div>
            </div>
        </section>

        <!-- My Deck Page -->
        <section id="my-deck" class="page">
            <div class="container">
                <h2>My Deck</h2>
                <div class="deck-controls text-animate-in">
                    <label for="sortDeck">Sort By:</label>
                    <select id="sortDeck">
                        <option value="none">None</option>
                        <option value="rarity">Rarity</option>
                        <option value="attack">Attack</option>
                        <option value="defense">Defense</option>
                        <option value="speed">Speed</option>
                        <option value="luck">Luck</option>
                    </select>
                </div>
                <div id="myDeckGrid" class="my-deck-grid">
                    <!-- Owned cards will be loaded here by JavaScript -->
                </div>
                <div id="cardDetailPopup" class="card-detail-popup" style="display: none;">
                    <div class="card-detail-content">
                        <span class="close-popup">&times;</span>
                        <h3 id="detailCardName"></h3>
                        <img id="detailCardImage" src="" alt="Card Image">
                        <p>Rarity: <span id="detailCardRarity"></span></p>
                        <p>Attack: <span id="detailCardAttack"></span></p>
                        <p>Defense: <span id="detailCardDefense"></span></p>
                        <p>Speed: <span id="detailCardSpeed"></span></p>
                        <p>Luck: <span id="detailCardLuck"></span></p>
                        <div class="card-actions">
                            <button class="glow-button simulate-button" data-action="upgrade">Upgrade (10 $SLUG) <span class="coming-soon-badge">Coming Soon</span></button>
                            <button class="glow-button simulate-button" data-action="fuse">Fuse (20 $SLUG) <span class="coming-soon-badge">Coming Soon</span></button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Leaderboard Page -->
        <section id="leaderboard" class="page">
            <div class="container">
                <h2>Leaderboard</h2>
                <div class="leaderboard-table-container section-animate-in">
                    <table id="leaderboardTable">
                        <thead>
                            <tr>
                                <th class="text-animate-in">Rank</th>
                                <th class="text-animate-in">Username</th>
                                <th class="text-animate-in">Wins</th>
                                <th class="text-animate-in">Earnings ($SLUG)</th> <!-- Changed to $SLUG -->
                            </tr>
                        </thead>
                        <tbody id="leaderboardBody">
                            <!-- Leaderboard data will be loaded here by JavaScript -->
                        </tbody>
                    </table>
                </div>
                <p class="weekly-update-note text-animate-in">Leaderboard updates weekly! Next update in <span id="countdown"></span></p>
            </div>
        </section>

        <!-- Token Page -->
        <section id="token" class="page">
            <div class="container">
                <h2>$SLUG Token</h2>
                <div class="token-info section-animate-in">
                    <h3 class="text-animate-in">Utility of $SLUG</h3>
                    <ul>
                        <li class="text-animate-in"><strong>Buy Characters:</strong> Acquire new and powerful character cards from the Shop.</li>
                        <li class="text-animate-in"><strong>Upgrade Cards:</strong> Enhance your existing cards' stats to make them stronger in battle.</li>
                        <li class="text-animate-in"><strong>Battle Entry:</strong> Players stake $SLUG to enter the arena and battle!</li> <!-- Updated text -->
                    </ul>

                    <h3 class="text-animate-in">Tokenomics</h3>
                    <p class="text-animate-in"><strong>Total Supply:</strong> 1,000,000,000 $SLUG</p>
                    <p class="text-animate-in"><strong>Use Cases:</strong> In-game currency, governance (future), staking rewards (future).</p>
                    <p class="text-animate-in"><strong>Basic Distribution:</strong></p>
                    <ul>
                        <li class="text-animate-in">50% Ecosystem & Rewards</li>
                        <li class="text-animate-in">20% Liquidity & Exchange Listings</li>
                        <li class="text-animate-in">15% Team & Advisors</li>
                        <li class="text-animate-in">10% Marketing & Partnerships</li>
                        <li class="text-animate-in">5% Community Treasury</li>
                    </ul>

                    <div class="token-actions">
                        <button id="buySlugBtn" class="glow-button">Buy $SLUG (Simulated) <span class="coming-soon-badge">Coming Soon</span></button>
                        <button id="stakeSlugBtn" class="glow-button">Stake $SLUG (Simulated) <span class="coming-soon-badge">Coming Soon</span></button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Docs Section -->
        <section id="docs" class="page">
            <div class="container">
                <h2>Documentation</h2>
                <div class="docs-section section-animate-in">
                    <p class="text-animate-in">Find comprehensive guides, technical specifications, and development resources for SolBattles on our GitHub documentation.</p>
                    <a href="https://github.com/SolBattles/docs" target="_blank" class="glow-button">Go to GitHub Docs</a>
                    <p class="text-animate-in" style="margin-top: 20px; font-size: 0.9em; color: #aaa;">(Note: This is a placeholder link for demonstration purposes.)</p>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 SolBattles. All rights reserved.</p>
        </div>
    </footer>

    <!-- Universal Popup -->
    <div id="universalPopup" class="universal-popup" style="display: none;">
        <div class="universal-popup-content">
            <span class="close-universal-popup">&times;</span>
            <p id="universalPopupMessage"></p>
            <button class="glow-button" onclick="document.getElementById('universalPopup').style.display='none'">OK</button>
        </div>
    </div>

    <script>
        // --- Global State Variables ---
        let currentSLUG = 1000; // Mock SLUG balance
        let ownedCards = []; // Array to hold player's owned cards
        let selectedBattleCards = []; // Cards chosen for battle
        let isWalletConnected = false;
        const MOCK_WALLET_ADDRESS = "0xS0Lbattl3sD3genWa1l3tAddr3ss";


        // --- Data Definitions (Mock Data) ---

        // Placeholder images - Using via.placeholder.com for direct embedding
        const PLACEHOLDER_CARD_IMAGES = [
            'https://via.placeholder.com/180x250/FF5733/FFFFFF?text=CHAR_01',
            'https://via.placeholder.com/180x250/33FF57/FFFFFF?text=CHAR_02',
            'https://via.placeholder.com/180x250/3357FF/FFFFFF?text=CHAR_03',
            'https://via.placeholder.com/180x250/FF33DA/FFFFFF?text=CHAR_04',
            'https://via.placeholder.com/180x250/33FFF5/FFFFFF?text=CHAR_05',
            'https://via.placeholder.com/180x250/FF8C33/FFFFFF?text=CHAR_06',
            'https://via.placeholder.com/180x250/8C33FF/FFFFFF?text=CHAR_07',
            'https://via.placeholder.com/180x250/33FF8C/FFFFFF?text=CHAR_08',
            'https://via.placeholder.com/180x250/FF338C/FFFFFF?text=CHAR_09',
            'https://via.placeholder.com/180x250/8CFF33/FFFFFF?text=CHAR_10',
            // Add more as needed
        ];

        // Placeholder for a generic card back
        const CARD_BACK_IMAGE = 'https://via.placeholder.com/180x250/533483/e0e0e0?text=CARD+BACK';


        const CHARACTER_NAMES = [
            "Shadowblade", "Firebrand", "Voidwalker", "Ironclad", "Stormbringer",
            "Grimfang", "Soulreaver", "Nightshade", "Frostbite", "Sunshard",
            "Cosmic Crusher", "Degen Dragon", "Pixel Paladin", "Crypto Knight", "Solana Sage"
        ];

        const RARITIES = ["Common", "Rare", "Epic", "Legendary"];
        const RARITY_WEIGHTS = { "Common": 0.6, "Rare": 0.25, "Epic": 0.1, "Legendary": 0.05 };

        // Shop inventory (mock)
        const shopInventory = [
            { id: 'shop001', name: 'Mystic Monk', img: PLACEHOLDER_CARD_IMAGES[0], attack: 60, defense: 40, speed: 50, luck: 30, rarity: 'Rare', price: 200 },
            { id: 'shop002', name: 'Cyber Rogue', img: PLACEHOLDER_CARD_IMAGES[1], attack: 70, defense: 30, speed: 80, luck: 40, rarity: 'Epic', price: 450 },
            { id: 'shop003', name: 'Stone Golem', img: PLACEHOLDER_CARD_IMAGES[2], attack: 80, defense: 90, speed: 10, luck: 10, rarity: 'Rare', price: 250 },
            { id: 'shop004', name: 'Arcane Archer', img: PLACEHOLDER_CARD_IMAGES[3], attack: 55, defense: 35, speed: 70, luck: 60, rarity: 'Common', price: 100 },
            { id: 'shop005', name: 'Desert Scavenger', img: PLACEHOLDER_CARD_IMAGES[4], attack: 45, defense: 45, speed: 55, luck: 70, rarity: 'Common', price: 90 },
            { id: 'shop006', name: 'Star-Forged Sentinel', img: PLACEHOLDER_CARD_IMAGES[5], attack: 90, defense: 80, speed: 20, luck: 30, rarity: 'Legendary', price: 800 },
            { id: 'shop007', name: 'Deep Sea Diver', img: PLACEHOLDER_CARD_IMAGES[6], attack: 65, defense: 60, speed: 45, luck: 50, rarity: 'Rare', price: 220 },
            { id: 'shop008', name: 'Galactic Gunslinger', img: PLACEHOLDER_CARD_IMAGES[7], attack: 75, defense: 25, speed: 90, luck: 65, rarity: 'Epic', price: 500 },
        ];

        // Initial player cards (for testing My Deck/Arena)
        function initializeOwnedCards() {
            ownedCards = [
                { id: 'player001', name: 'Basic Brawler', img: PLACEHOLDER_CARD_IMAGES[8], attack: 50, defense: 50, speed: 50, luck: 50, rarity: 'Common', level: 1 },
                { id: 'player002', name: 'Forest Spirit', img: PLACEHOLDER_CARD_IMAGES[9], attack: 40, defense: 60, speed: 45, luck: 55, rarity: 'Rare', level: 1 },
                { id: 'player003', name: 'Knight Protector', img: PLACEHOLDER_CARD_IMAGES[0], attack: 65, defense: 75, speed: 30, luck: 20, rarity: 'Epic', level: 1 },
                { id: 'player004', name: 'Speed Demon', img: PLACEHOLDER_CARD_IMAGES[1], attack: 70, defense: 30, speed: 90, luck: 40, rarity: 'Rare', level: 1 },
                { id: 'player005', name: 'Lucky Charm', img: PLACEHOLDER_CARD_IMAGES[2], attack: 30, defense: 30, speed: 60, luck: 90, rarity: 'Common', level: 1 },
                { id: 'player006', name: 'Master Mage', img: PLACEHOLDER_CARD_IMAGES[3], attack: 80, defense: 35, speed: 50, luck: 60, rarity: 'Legendary', level: 1 },
            ];
        }

        // Mock Leaderboard Data
        // Earnings are now in $SLUG
        let leaderboardData = [
            { rank: 1, username: 'CryptoKing', wins: 150, earnings: 75250 },
            { rank: 2, username: 'NFT_God', wins: 145, earnings: 70100 },
            { rank: 3, username: 'DegenWarrior', wins: 130, earnings: 62500 },
            { rank: 4, username: 'SolanaChamp', wins: 120, earnings: 58000 },
            { rank: 5, username: 'BlockchainBeast', wins: 110, earnings: 50750 },
            { rank: 6, username: 'PixelPirate', wins: 95, earnings: 45000 },
            { rank: 7, username: 'TokenTamer', wins: 88, earnings: 40200 },
            { rank: 8, username: 'MetaMaverick', wins: 80, earnings: 35800 },
            { rank: 9, username: 'CardConjurer', wins: 75, earnings: 32100 },
            { rank: 10, username: 'EliteEnder', wins: 70, earnings: 29500 },
        ];

        // --- Utility Functions ---

        /**
         * Generates a unique ID for a card.
         * @returns {string} Unique card ID.
         */
        function generateCardId() {
            return 'card_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        /**
         * Gets a random element from an array.
         * @param {Array} arr - The array to pick from.
         * @returns {*} A random element from the array.
         */
        function getRandomElement(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        /**
         * Generates a random card with stats and rarity.
         * @returns {object} A new card object.
         */
        function generateRandomCard() {
            const rarity = getRandomRarity();
            const baseStats = {
                'Common': { min: 30, max: 60 },
                'Rare': { min: 50, max: 80 },
                'Epic': { min: 70, max: 95 },
                'Legendary': { min: 85, max: 100 }
            };
            const statsRange = baseStats[rarity];

            const generateStat = () => Math.floor(Math.random() * (statsRange.max - statsRange.min + 1)) + statsRange.min;

            return {
                id: generateCardId(),
                name: getRandomElement(CHARACTER_NAMES),
                img: getRandomElement(PLACEHOLDER_CARD_IMAGES),
                attack: generateStat(),
                defense: generateStat(),
                speed: generateStat(),
                luck: generateStat(),
                rarity: rarity,
                level: 1 // All new cards start at level 1
            };
        }

        /**
         * Determines a random rarity based on weights.
         * @returns {string} The determined rarity.
         */
        function getRandomRarity() {
            let sum = 0;
            const r = Math.random();
            for (const rarity of RARITIES) {
                sum += RARITY_WEIGHTS[rarity];
                if (r <= sum) {
                    return rarity;
                }
            }
            return "Common"; // Fallback
        }

        /**
         * Creates an HTML string for a card.
         * @param {object} card - The card object.
         * @param {boolean} showBuyButton - Whether to show a buy button (for shop).
         * @param {boolean} isSelectableForBattle - Whether the card can be selected for battle.
         * @returns {string} HTML string for the card.
         */
        function createCardHTML(card, showBuyButton = false, isSelectableForBattle = false) {
            const buyButtonHTML = showBuyButton ? `<button class="glow-button buy-button" data-card-id="${card.id}">Buy (${card.price} $SLUG)</button>` : '';
            const levelHTML = card.level ? `<p>Level: ${card.level}</p>` : '';
            const selectableClass = isSelectableForBattle ? 'selectable-card' : '';
            const selectedClass = selectedBattleCards.some(c => c.id === card.id) ? 'selected' : '';

            // Add onerror to image tags for fallback
            const imgSrc = card.img || 'https://via.placeholder.com/180x250/333333/FFFFFF?text=IMG+ERROR';

            return `
                <div class="card ${selectableClass} ${selectedClass}" data-card-id="${card.id}">
                    <img src="${imgSrc}" alt="${card.name}" onerror="this.onerror=null;this.src='https://via.placeholder.com/180x250/333333/FFFFFF?text=IMG+ERROR';">
                    <h4>${card.name}</h4>
                    <p class="rarity ${card.rarity.toLowerCase()}">${card.rarity}</p>
                    ${levelHTML}
                    <div class="card-stats">
                        <span class="card-stat">ATK: ${card.attack}</span>
                        <span class="card-stat">DEF: ${card.defense}</span>
                        <span class="card-stat">SPD: ${card.speed}</span>
                        <span class="card-stat">LCK: ${card.luck}</span>
                    </div>
                    ${buyButtonHTML}
                </div>
            `;
        }

        /**
         * Displays a universal popup message.
         * @param {string} message - The message to display.
         */
        function showUniversalPopup(message) {
            const popup = document.getElementById('universalPopup');
            document.getElementById('universalPopupMessage').textContent = message;
            popup.style.display = 'flex';
            // Close popup on click outside or on 'X' button
            popup.querySelector('.close-universal-popup').onclick = () => popup.style.display = 'none';
            popup.onclick = (e) => {
                if (e.target === popup) {
                    popup.style.display = 'none';
                }
            };
        }

        // --- Page Rendering Functions ---

        /**
         * Renders the shop grid with available cards and pack opening section.
         */
        function renderShop() {
            const shopGrid = document.getElementById('shopGrid');
            shopGrid.innerHTML = ''; // Clear previous items

            shopInventory.forEach(card => {
                shopGrid.innerHTML += createCardHTML(card, true);
            });

            // Add event listeners for buy buttons
            shopGrid.querySelectorAll('.buy-button').forEach(button => {
                button.onclick = (event) => {
                    const cardId = event.target.dataset.cardId;
                    handleBuyCard(cardId);
                };
            });

            // Re-attach event listener for openPackBtn if it exists
            const openPackBtn = document.getElementById('openPackBtn');
            if (openPackBtn) {
                openPackBtn.onclick = handleOpenPack;
            }
            // Ensure pack opening animation and revealed cards are reset
            document.getElementById('packOpeningAnimation').style.display = 'none';
            document.getElementById('revealedCards').innerHTML = '';
        }

        /**
         * Renders the player's deck.
         * @param {string} sortBy - The attribute to sort cards by.
         */
        function renderMyDeck(sortBy = 'none') {
            const myDeckGrid = document.getElementById('myDeckGrid');
            myDeckGrid.innerHTML = ''; // Clear previous items

            let cardsToDisplay = [...ownedCards]; // Create a copy to sort

            if (sortBy !== 'none') {
                cardsToDisplay.sort((a, b) => {
                    if (sortBy === 'rarity') {
                        const rarityOrder = { 'Common': 1, 'Rare': 2, 'Epic': 3, 'Legendary': 4 };
                        return rarityOrder[a.rarity] - rarityOrder[b.rarity];
                    }
                    return b[sortBy] - a[sortBy]; // Sort descending for stats
                });
            }

            if (cardsToDisplay.length === 0) {
                myDeckGrid.innerHTML = '<p>Your deck is empty! Visit the Shop to get new cards.</p>';
                return;
            }

            cardsToDisplay.forEach(card => {
                myDeckGrid.innerHTML += createCardHTML(card);
            });

            // Add event listeners for card details popup
            myDeckGrid.querySelectorAll('.card').forEach(cardElement => {
                cardElement.onclick = (event) => {
                    const cardId = event.currentTarget.dataset.cardId;
                    const card = ownedCards.find(c => c.id === cardId);
                    if (card) {
                        showCardDetail(card);
                    }
                };
            });
        }

        /**
         * Shows a detailed view of a card in a popup.
         * @param {object} card - The card object to display.
         */
        function showCardDetail(card) {
            const popup = document.getElementById('cardDetailPopup');
            document.getElementById('detailCardName').textContent = card.name;
            document.getElementById('detailCardImage').src = card.img;
            // Add onerror to image tags for fallback in popup
            document.getElementById('detailCardImage').onerror = function() { this.onerror=null; this.src='https://via.placeholder.com/180x250/333333/FFFFFF?text=IMG+ERROR'; };

            document.getElementById('detailCardRarity').textContent = card.rarity;
            document.getElementById('detailCardRarity').className = `rarity ${card.rarity.toLowerCase()}`;
            document.getElementById('detailCardAttack').textContent = card.attack;
            document.getElementById('detailCardDefense').textContent = card.defense;
            document.getElementById('detailCardSpeed').textContent = card.speed;
            document.getElementById('detailCardLuck').textContent = card.luck;

            popup.style.display = 'flex';

            // Add event listeners for simulated actions
            popup.querySelectorAll('.simulate-button').forEach(button => {
                button.onclick = (e) => {
                    const action = e.target.dataset.action;
                    if (action === 'upgrade') {
                        handleUpgradeCard(card.id);
                    } else if (action === 'fuse') {
                        handleFuseCard(card.id);
                    }
                    popup.style.display = 'none'; // Close popup after action
                };
            });

            popup.querySelector('.close-popup').onclick = () => popup.style.display = 'none';
            popup.onclick = (e) => {
                if (e.target === popup) {
                    popup.style.display = 'none';
                }
            };
        }


        /**
         * Renders the cards available for selection in the Battle Arena.
         */
        function renderArenaCardSelection() {
            const battleCardSelection = document.getElementById('battleCardSelection');
            battleCardSelection.innerHTML = ''; // Clear previous items
            selectedBattleCards = []; // Reset selected cards on page load

            if (ownedCards.length === 0) {
                battleCardSelection.innerHTML = '<p>You need cards to battle! Visit My Deck or the Shop.</p>';
                document.getElementById('startBattleBtn').disabled = true;
                return;
            }

            ownedCards.forEach(card => {
                battleCardSelection.innerHTML += createCardHTML(card, false, true);
            });

            // Add click listeners for selection
            battleCardSelection.querySelectorAll('.selectable-card').forEach(cardElement => {
                cardElement.onclick = (event) => {
                    const cardId = event.currentTarget.dataset.cardId;
                    const card = ownedCards.find(c => c.id === cardId);

                    if (selectedBattleCards.some(c => c.id === cardId)) {
                        // Deselect
                        selectedBattleCards = selectedBattleCards.filter(c => c.id !== cardId);
                        event.currentTarget.classList.remove('selected');
                    } else if (selectedBattleCards.length < 3) {
                        // Select
                        selectedBattleCards.push(card);
                        event.currentTarget.classList.add('selected');
                    } else {
                        showUniversalPopup('You can only select up to 3 cards for battle.');
                    }
                    // Enable/disable start battle button
                    document.getElementById('startBattleBtn').disabled = selectedBattleCards.length !== 3;
                };
            });
            document.getElementById('startBattleBtn').disabled = selectedBattleCards.length !== 3; // Initial state
        }


        /**
         * Renders the leaderboard table.
         */
        function renderLeaderboard() {
            const leaderboardBody = document.getElementById('leaderboardBody');
            leaderboardBody.innerHTML = '';

            leaderboardData.forEach(player => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${player.rank}</td>
                    <td>${player.username}</td>
                    <td>${player.wins}</td>
                    <td>${player.earnings.toFixed(0)} $SLUG</td> <!-- Earnings in $SLUG -->
                `;
                leaderboardBody.appendChild(row);
            });
            startLeaderboardCountdown();
        }


        // --- Event Handlers and Core Logic ---

        /**
         * Handles wallet connection simulation.
         */
        document.getElementById('connectWalletBtn').onclick = () => {
            const connectBtn = document.getElementById('connectWalletBtn');
            const walletStatusDiv = document.getElementById('walletStatus');
            const walletConnectionText = document.getElementById('walletConnectionText');
            const walletAddressSpan = document.getElementById('walletAddress');

            if (!isWalletConnected) {
                connectBtn.textContent = 'Connecting...';
                connectBtn.disabled = true;
                walletStatusDiv.style.display = 'flex';
                walletStatusDiv.classList.add('connecting');
                walletConnectionText.textContent = 'Connecting...';
                walletAddressSpan.textContent = ''; // Clear address during connection

                setTimeout(() => {
                    isWalletConnected = true;
                    connectBtn.style.display = 'none'; // Hide connect button
                    walletStatusDiv.classList.remove('connecting');
                    walletStatusDiv.classList.add('connected');
                    walletConnectionText.textContent = 'Wallet Connected';
                    walletAddressSpan.textContent = MOCK_WALLET_ADDRESS.substring(0, 6) + '...' + MOCK_WALLET_ADDRESS.substring(MOCK_WALLET_ADDRESS.length - 4); // Display truncated address
                    updateSLUGDisplay(); // Update balance
                    showUniversalPopup('Wallet connected! Welcome to SolBattles!');
                }, 2000); // Simulate connection delay
            }
        };


        /**
         * Handles "Open Pack" button click.
         */
        function handleOpenPack() {
            if (currentSLUG < 50) {
                showUniversalPopup('Not enough $SLUG to open a pack! You need 50 $SLUG.');
                return;
            }

            currentSLUG -= 50; // Deduct SLUG
            updateSLUGDisplay();
            showUniversalPopup('You spent 50 $SLUG to open a pack!');

            const packAnimationDiv = document.getElementById('packOpeningAnimation');
            const revealedCardsDiv = document.getElementById('revealedCards');
            revealedCardsDiv.innerHTML = '';
            packAnimationDiv.style.display = 'flex'; // Show animation

            // Simulate pack opening animation
            setTimeout(() => {
                packAnimationDiv.style.display = 'none'; // Hide animation
                const newCards = [];
                for (let i = 0; i < 3; i++) {
                    const newCard = generateRandomCard();
                    ownedCards.push(newCard); // Add to player's deck
                    newCards.push(newCard);
                }

                // Display revealed cards with flip animation
                newCards.forEach((card, index) => {
                    const cardContainer = document.createElement('div');
                    cardContainer.className = 'card-flip-container'; // For flip animation
                    cardContainer.style.width = '12.5rem'; /* Match card width from CSS */
                    cardContainer.style.height = '18.75rem'; /* Match card height from CSS */

                    // Initial state: showing card back
                    cardContainer.innerHTML = `
                        <div class="card-front">
                            <img src="${CARD_BACK_IMAGE}" alt="Card Back" onerror="this.onerror=null;this.src='https://via.placeholder.com/180x250/333333/FFFFFF?text=IMG+ERROR';">
                        </div>
                        <div class="card-back">
                            <img src="${card.img}" alt="${card.name}" onerror="this.onerror=null;this.src='https://via.placeholder.com/180x250/333333/FFFFFF?text=IMG+ERROR';">
                            <h4>${card.name}</h4>
                            <p class="rarity ${card.rarity.toLowerCase()}">${card.rarity}</p>
                            <div class="card-stats">
                                <span class="card-stat">ATK: ${card.attack}</span>
                                <span class="card-stat">DEF: ${card.defense}</span>
                                <span class="card-stat">SPD: ${card.speed}</span>
                                <span class="card-stat">LCK: ${card.luck}</span>
                            </div>
                        </div>
                    `;
                    revealedCardsDiv.appendChild(cardContainer);

                    // Trigger flip animation with a staggered delay
                    setTimeout(() => {
                        cardContainer.style.transform = 'rotateY(180deg)';
                    }, index * 200); // Stagger cards by 200ms
                });
                showUniversalPopup('You received 3 new cards!');
            }, 2000); // 2 seconds animation for pack opening
        };

        // Attach event listener for the openPackBtn when the DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            const openPackBtn = document.getElementById('openPackBtn');
            if (openPackBtn) {
                openPackBtn.onclick = handleOpenPack;
            }
        });


        /**
         * Handles buying a card from the shop.
         * @param {string} cardId - The ID of the card to buy.
         */
        function handleBuyCard(cardId) {
            const cardToBuy = shopInventory.find(card => card.id === cardId);
            if (cardToBuy) {
                if (currentSLUG >= cardToBuy.price) {
                    currentSLUG -= cardToBuy.price;
                    ownedCards.push({ ...cardToBuy, id: generateCardId(), level: 1 }); // Add to owned cards, give new ID
                    updateSLUGDisplay();
                    showUniversalPopup(`Successfully purchased ${cardToBuy.name} for ${cardToBuy.price} $SLUG! It's now in your deck.`);
                    renderShop(); // Re-render shop to reflect potential removal (not implemented here, but good practice)
                } else {
                    showUniversalPopup(`Not enough $SLUG to buy ${cardToBuy.name}! You need ${cardToBuy.price} $SLUG.`);
                }
            }
        }

        /**
         * Handles the "Upgrade" button click for a card.
         * @param {string} cardId - The ID of the card to upgrade.
         */
        function handleUpgradeCard(cardId) {
            const cardToUpgrade = ownedCards.find(card => card.id === cardId);
            if (cardToUpgrade) {
                if (currentSLUG >= 10) { // Mock upgrade cost
                    currentSLUG -= 10;
                    cardToUpgrade.level = (cardToUpgrade.level || 1) + 1; // Increment level
                    cardToUpgrade.attack += 5; // Example stat increase
                    cardToUpgrade.defense += 5;
                    updateSLUGDisplay();
                    showUniversalPopup(`${cardToUpgrade.name} upgraded to Level ${cardToUpgrade.level}! (Simulated) Stats increased.`);
                    renderMyDeck(document.getElementById('sortDeck').value); // Re-render deck
                } else {
                    showUniversalPopup('Not enough $SLUG to upgrade! You need 10 $SLUG.');
                }
            }
        }

        /**
         * Handles the "Fuse" button click for a card.
         * @param {string} cardId - The ID of the card to fuse.
         */
        function handleFuseCard(cardId) {
            // In a real game, fusion might require multiple cards and specific conditions.
            // Here, we'll just simulate a success message and SLUG deduction.
            const cardToFuse = ownedCards.find(card => card.id === cardId);
            if (cardToFuse) {
                if (currentSLUG >= 20) { // Mock fuse cost
                    currentSLUG -= 20;
                    // Simulate removal of the card or creation of a new one
                    // For simplicity, just remove it here
                    ownedCards = ownedCards.filter(c => c.id !== cardId);
                    updateSLUGDisplay();
                    showUniversalPopup(`${cardToFuse.name} has been fused! (Simulated - card removed from deck).`);
                    renderMyDeck(document.getElementById('sortDeck').value); // Re-render deck
                } else {
                    showUniversalPopup('Not enough $SLUG to fuse! You need 20 $SLUG.');
                }
            }
        }


        /**
         * Updates the display of the current $SLUG balance.
         */
        function updateSLUGDisplay() {
            const slugBalanceDisplay = document.getElementById('slugBalanceDisplay');
            const mockSlugWalletBalance = document.getElementById('mockSlugWalletBalance');

            if (slugBalanceDisplay) {
                slugBalanceDisplay.textContent = `Balance: ${currentSLUG} $SLUG`;
            }
            if (mockSlugWalletBalance) {
                mockSlugWalletBalance.textContent = currentSLUG;
            }
        }

        /**
         * Simulates a battle between the selected cards and a random opponent team.
         */
        document.getElementById('startBattleBtn').onclick = () => {
            if (selectedBattleCards.length !== 3) {
                showUniversalPopup('Please select exactly 3 cards to start a battle.');
                return;
            }

            const slugStake = parseFloat(document.getElementById('slugStake').value);
            if (isNaN(slugStake) || slugStake <= 0) {
                showUniversalPopup('Please enter a valid $SLUG stake amount.');
                return;
            }

            if (currentSLUG < slugStake) {
                showUniversalPopup(`Not enough $SLUG for stake! You need ${slugStake} $SLUG, but have ${currentSLUG} $SLUG.`);
                return;
            }

            // Deduct $SLUG stake at the start
            currentSLUG -= slugStake;
            updateSLUGDisplay();
            showUniversalPopup(`Staking ${slugStake} $SLUG to enter battle! Simulating match... Your new balance: ${currentSLUG} $SLUG.`);


            const battleResultsBox = document.getElementById('battleResults');
            const battleLog = document.getElementById('battleLog');
            const battleWinner = document.getElementById('battleWinner');
            const battleLoser = document.getElementById('battleLoser');

            battleLog.innerHTML = '';
            battleWinner.textContent = '';
            battleLoser.textContent = '';
            document.getElementById('arena').querySelector('.arena-setup').style.display = 'none'; // Hide setup
            battleResultsBox.style.display = 'block';

            // Generate mock opponent cards
            const opponentCards = [];
            for (let i = 0; i < 3; i++) {
                opponentCards.push(generateRandomCard());
            }

            let playerTeam = [...selectedBattleCards];
            let opponentTeam = [...opponentCards];

            // Initialize currentHealth for all participants
            playerTeam.forEach(card => card.currentHealth = 100);
            opponentTeam.forEach(card => card.currentHealth = 100);


            battleLog.innerHTML += '<p><strong>--- Battle Start ---</strong></p>';
            battleLog.innerHTML += `<p>Your team: ${playerTeam.map(c => c.name).join(', ')}</p>`;
            battleLog.innerHTML += `<p>Opponent team: ${opponentTeam.map(c => c.name).join(', ')}</p>`;

            let turn = 1;
            let maxTurns = 15; // Prevent excessively long loops

            const battleTurnsInterval = setInterval(() => {
                if (playerTeam.length === 0 || opponentTeam.length === 0 || turn > maxTurns) {
                    clearInterval(battleTurnsInterval);
                    // Determine winner
                    if (playerTeam.length > 0 && opponentTeam.length === 0) {
                        battleWinner.textContent = 'YOU WIN!';
                        battleWinner.style.color = '#4CAF50';
                        const winnings = slugStake * 1.9; // Original stake + 90% of opponent's stake (total pot minus 5% fee)
                        currentSLUG += winnings;
                        battleLoser.textContent = `You earned ${winnings.toFixed(0)} $SLUG! Your new balance: ${currentSLUG.toFixed(0)} $SLUG.`; // Mock earnings
                        battleLog.innerHTML += '<p class="winner-message">Congratulations! Your team emerged victorious!</p>';
                        // Simulate updating leaderboard for player
                        let playerEntry = leaderboardData.find(p => p.username === 'You');
                        if (!playerEntry) {
                            playerEntry = { rank: 0, username: 'You', wins: 0, earnings: 0 };
                            leaderboardData.push(playerEntry);
                        }
                        playerEntry.wins += 1;
                        playerEntry.earnings += winnings;
                        sortLeaderboard();
                        updateSLUGDisplay(); // Update display again
                    } else if (opponentTeam.length > 0 && playerTeam.length === 0) {
                        battleWinner.textContent = 'YOU LOSE!';
                        battleWinner.style.color = '#F44336';
                        battleLoser.textContent = `You lost ${slugStake} $SLUG. Better luck next time! Your new balance: ${currentSLUG} $SLUG.`;
                        battleLog.innerHTML += '<p class="loser-message">Your team was defeated. Train harder!</p>';
                        // For a loss, $SLUG is already deducted. Leaderboard earnings unchanged for player.
                    } else { // Draw or max turns reached
                        battleWinner.textContent = 'IT\'S A DRAW!';
                        battleWinner.style.color = '#FFC107';
                        // Return staked $SLUG for a draw
                        currentSLUG += slugStake;
                        battleLoser.textContent = `It's a draw! Your ${slugStake} $SLUG stake has been returned. Your new balance: ${currentSLUG} $SLUG.`;
                        battleLog.innerHTML += '<p>The battle was a fierce draw. No clear winner.</p>';
                        updateSLUGDisplay(); // Update display again
                    }
                    // Scroll to bottom of battle log
                    battleLog.scrollTop = battleLog.scrollHeight;

                    // Reset selected cards and button state
                    selectedBattleCards.forEach(card => {
                        const cardElement = document.querySelector(`.selectable-card[data-card-id="${card.id}"]`);
                        if (cardElement) {
                            cardElement.classList.remove('selected');
                        }
                    });
                    selectedBattleCards = [];
                    document.getElementById('startBattleBtn').disabled = true;
                    // Show arena setup again for new battle
                    document.getElementById('arena').querySelector('.arena-setup').style.display = 'block';

                    return;
                }

                battleLog.innerHTML += `<p><strong>--- Turn ${turn} ---</strong></p>`;

                // Player's turn to attack
                if (playerTeam.length > 0) {
                    const playerAttacker = getRandomElement(playerTeam);
                    const opponentDefender = getRandomElement(opponentTeam);

                    const playerDamage = Math.max(0, Math.round(playerAttacker.attack * (1 + (playerAttacker.luck - 50) / 100) - opponentDefender.defense * (1 - (opponentDefender.luck - 50) / 100) * 0.5));
                    opponentDefender.currentHealth -= playerDamage; // Simulate health

                    battleLog.innerHTML += `<p>ðŸ›¡ï¸ ${playerAttacker.name} attacks ${opponentDefender.name} for ${playerDamage} damage!`;

                    if (opponentDefender.currentHealth <= 0) {
                        battleLog.innerHTML += `<p class="loser-message">ðŸ’€ ${opponentDefender.name} has been defeated!</p>`;
                        opponentTeam = opponentTeam.filter(c => c.id !== opponentDefender.id);
                    } else {
                        battleLog.innerHTML += `<p>${opponentDefender.name} health: ${opponentDefender.currentHealth.toFixed(0)}</p>`;
                    }
                }

                if (opponentTeam.length === 0) return; // Check if opponent is defeated immediately after player's turn

                // Opponent's turn to attack
                if (opponentTeam.length > 0) {
                    const opponentAttacker = getRandomElement(opponentTeam);
                    const playerDefender = getRandomElement(playerTeam);

                    const opponentDamage = Math.max(0, Math.round(opponentAttacker.attack * (1 + (opponentAttacker.luck - 50) / 100) - playerDefender.defense * (1 - (playerDefender.luck - 50) / 100) * 0.5));
                    playerDefender.currentHealth -= opponentDamage;

                    battleLog.innerHTML += `<p>âš”ï¸ ${opponentAttacker.name} attacks ${playerDefender.name} for ${opponentDamage} damage!`;

                    if (playerDefender.currentHealth <= 0) {
                        battleLog.innerHTML += `<p class="loser-message">ðŸ’€ ${playerDefender.name} has been defeated!</p>`;
                        playerTeam = playerTeam.filter(c => c.id !== playerDefender.id);
                    } else {
                        battleLog.innerHTML += `<p>${playerDefender.name} health: ${playerDefender.currentHealth.toFixed(0)}</p>`;
                    }
                }

                battleLog.scrollTop = battleLog.scrollHeight; // Scroll to bottom after each turn
                turn++;
            }, 1000); // Each turn takes 1 second
        };


        document.getElementById('resetBattleBtn').onclick = () => {
            document.getElementById('battleResults').style.display = 'none';
            document.getElementById('arena').querySelector('.arena-setup').style.display = 'block'; // Show setup again
            renderArenaCardSelection(); // Reset card selection for new battle
        };


        /**
         * Handles mock "Buy $SLUG" button click.
         */
        document.getElementById('buySlugBtn').onclick = () => {
            showUniversalPopup('Simulating $SLUG purchase... In a real DApp, this would connect to a DEX. (Coming Soon!)');
            currentSLUG += 500; // Mock addition
            updateSLUGDisplay();
        };

        /**
         * Handles mock "Stake $SLUG" button click.
         */
        document.getElementById('stakeSlugBtn').onclick = () => {
            showUniversalPopup('Simulating $SLUG staking... This feature will enable earning passive rewards. (Coming Soon!)');
        };

        /**
         * Sorts the leaderboard data and updates ranks.
         */
        function sortLeaderboard() {
            leaderboardData.sort((a, b) => b.wins - a.wins || b.earnings - a.earnings); // Sort by wins, then earnings
            leaderboardData.forEach((player, index) => {
                player.rank = index + 1;
            });
        }

        /**
         * Simulates weekly leaderboard update with animated rank changes.
         */
        function updateLeaderboardWeekly() {
            // Store current state for comparison
            const oldLeaderboardData = JSON.parse(JSON.stringify(leaderboardData));

            // Simulate some changes (e.g., random wins, new player, existing player drop)
            leaderboardData.forEach(player => {
                player.wins += Math.floor(Math.random() * 5); // Add random wins
                player.earnings = parseFloat((player.earnings + (Math.random() * 500)).toFixed(0)); // Add random earnings in $SLUG
            });

            // Add a potential new player
            if (Math.random() > 0.7) { // 30% chance of new player
                leaderboardData.push({ rank: 0, username: 'Newbie' + Math.floor(Math.random() * 100), wins: Math.floor(Math.random() * 10), earnings: parseFloat((Math.random() * 500).toFixed(0)) });
            }

            sortLeaderboard(); // Re-sort after changes

            const leaderboardBody = document.getElementById('leaderboardBody');
            leaderboardBody.innerHTML = ''; // Clear current table

            leaderboardData.forEach(player => {
                const oldPlayer = oldLeaderboardData.find(p => p.username === player.username);
                let rankChangeIndicator = '';
                if (oldPlayer) {
                    if (player.rank < oldPlayer.rank) {
                        rankChangeIndicator = '<span class="rank-change up">â¬†ï¸</span>';
                    } else if (player.rank > oldPlayer.rank) {
                        rankChangeIndicator = '<span class="rank-change down">â¬‡ï¸</span>';
                    }
                } else { // New player
                    rankChangeIndicator = '<span class="rank-change new">âœ¨ New!</span>';
                }

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${player.rank}${rankChangeIndicator}</td>
                    <td>${player.username}</td>
                    <td>${player.wins}</td>
                    <td>${player.earnings.toFixed(0)} $SLUG</td>
                `;
                leaderboardBody.appendChild(row);
            });
            showUniversalPopup('Leaderboard has been updated!');
        }

        let countdownInterval;
        /**
         * Starts the weekly leaderboard countdown.
         */
        function startLeaderboardCountdown() {
            clearInterval(countdownInterval); // Clear any existing interval
            const countdownElement = document.getElementById('countdown');
            let secondsLeft = 7 * 24 * 60 * 60; // 7 days in seconds (mock)

            function updateCountdown() {
                const days = Math.floor(secondsLeft / (24 * 60 * 60));
                const hours = Math.floor((secondsLeft % (24 * 60 * 60)) / (60 * 60));
                const minutes = Math.floor((secondsLeft % (60 * 60)) / 60);
                const seconds = secondsLeft % 60;

                countdownElement.textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;

                if (secondsLeft <= 0) {
                    clearInterval(countdownInterval);
                    countdownElement.textContent = 'Updating now...';
                    updateLeaderboardWeekly();
                    secondsLeft = 7 * 24 * 60 * 60; // Reset for next week
                    setTimeout(startLeaderboardCountdown, 5000); // Restart countdown after update
                } else {
                    secondsLeft--;
                }
            }
            updateCountdown(); // Call immediately to avoid initial delay
            countdownInterval = setInterval(updateCountdown, 1000);
        }


        // --- Page Navigation Logic ---
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetPageId = e.target.dataset.page;

                // Deactivate all pages and nav links
                document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
                document.querySelectorAll('.nav-link').forEach(navLink => navLink.classList.remove('active'));

                // Deactivate all section animations when changing page
                document.querySelectorAll('.section-animate-in.visible').forEach(element => {
                    element.classList.remove('visible');
                    element.querySelectorAll('.text-animate-in.visible').forEach(textElement => textElement.classList.remove('visible'));
                });
                document.querySelectorAll('.feature-item.visible').forEach(element => element.classList.remove('visible'));
                document.querySelectorAll('.roadmap-phase.visible').forEach(element => element.classList.remove('visible'));


                // Activate the clicked page and nav link
                const activePage = document.getElementById(targetPageId);
                activePage.classList.add('active');
                e.target.classList.add('active');

                // Animate content of the new active page
                // Use a slight delay to ensure the display property is applied before animation
                setTimeout(() => {
                    // Animate main sections
                    activePage.querySelectorAll('.section-animate-in').forEach((section, index) => {
                        section.style.transitionDelay = `${index * 0.2}s`; // Increased stagger sections
                        section.classList.add('visible');
                    });

                    // Animate feature items (nested within roadmap-section, or directly in homepage)
                    activePage.querySelectorAll('.feature-item').forEach((item, index) => {
                        item.style.transitionDelay = `${index * 0.25}s`; // Increased stagger
                        item.classList.add('visible');
                    });

                    // Animate roadmap phases (nested within roadmap-section)
                    activePage.querySelectorAll('.roadmap-phase').forEach((phase, index) => {
                        phase.style.transitionDelay = `${index * 0.25}s`; // Increased stagger
                        phase.classList.add('visible');
                    });

                    // Animate general text elements
                    activePage.querySelectorAll('.text-animate-in').forEach((textElement, index) => {
                        // Ensure text animates after its parent section is visible
                        if (textElement.closest('.section-animate-in.visible') || textElement.closest('.feature-item.visible') || textElement.closest('.roadmap-phase.visible')) {
                            textElement.style.transitionDelay = `${index * 0.1}s`; // Stagger text
                            textElement.classList.add('visible');
                        }
                    });
                }, 100);


                // Render content specific to the page
                if (targetPageId === 'shop') {
                    renderShop();
                } else if (targetPageId === 'my-deck') {
                    renderMyDeck(document.getElementById('sortDeck').value);
                } else if (targetPageId === 'arena') {
                    renderArenaCardSelection();
                    document.getElementById('battleResults').style.display = 'none'; // Hide results on entering arena
                    document.getElementById('arena').querySelector('.arena-setup').style.display = 'block'; // Ensure setup is visible
                } else if (targetPageId === 'leaderboard') {
                    renderLeaderboard();
                }
                // No specific render function needed for 'docs' as it's static content
            });
        });

        // My Deck sorting functionality
        document.getElementById('sortDeck').addEventListener('change', (e) => {
            renderMyDeck(e.target.value);
        });


        // --- Custom Cursor and Trail Logic ---
        const customCursor = document.getElementById('custom-cursor');
        const cursorTrailContainer = document.getElementById('cursorTrailContainer');
        let mouseX = 0, mouseY = 0;
        let lastFrameTime = 0;
        const trailFrequency = 20; // Milliseconds between new trail particles (more frequent)
        const particleSizeMin = 10; // Larger minimum size
        const particleSizeMax = 25; // Larger maximum size
        const particleDuration = 1500; // Longer fade out duration

        function updateCustomCursor() {
            if (customCursor) {
                customCursor.style.left = `${mouseX}px`;
                customCursor.style.top = `${mouseY}px`;
            }
            requestAnimationFrame(updateCustomCursor);
        }

        document.addEventListener('mousemove', (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;

            const currentTime = Date.now();
            if (currentTime - lastFrameTime > trailFrequency) {
                createTrailParticle(mouseX, mouseY);
                lastFrameTime = currentTime;
            }
        });

        function createTrailParticle(x, y) {
            const particle = document.createElement('div');
            particle.className = 'cursor-trail-particle';
            const size = Math.random() * (particleSizeMax - particleSizeMin) + particleSizeMin;
            particle.style.width = `${size}px`;
            particle.style.height = `${size}px`;
            particle.style.left = `${x - size / 2}px`;
            particle.style.top = `${y - size / 2}px`;
            cursorTrailContainer.appendChild(particle);

            // Remove particle after animation
            setTimeout(() => {
                particle.remove();
            }, particleDuration);
        }

        // Start the custom cursor animation loop
        requestAnimationFrame(updateCustomCursor);


        // --- Parallax Scroll Effect for Homepage Hero ---
        const homeHero = document.getElementById('homeHero');
        if (homeHero) {
            window.addEventListener('scroll', () => {
                // Check if the home page is currently active before applying parallax
                if (document.getElementById('home').classList.contains('active')) {
                    const scrollPosition = window.pageYOffset;
                    // Adjust background position based on scroll, creating a parallax effect
                    // The '0.3' here determines the speed of the parallax (lower means slower, more pronounced effect)
                    homeHero.style.backgroundPositionY = `${scrollPosition * 0.4}px`; // Slightly faster parallax
                }
            });
        }

        // --- Intersection Observer for Section Animations ---
        // This observes sections and adds 'visible' class when they enter viewport
        const observerOptions = {
            root: null, // relative to the viewport
            rootMargin: '0px',
            threshold: 0.1 // 10% of the element must be visible
        };

        const sectionObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                    // Animate direct children text elements with staggering
                    entry.target.querySelectorAll('.text-animate-in').forEach((textElement, index) => {
                        textElement.style.transitionDelay = `${index * 0.1}s`; // Stagger text
                        textElement.classList.add('visible');
                    });
                    // Animate nested feature items and roadmap phases
                    entry.target.querySelectorAll('.feature-item, .roadmap-phase').forEach((nestedElement, index) => {
                        nestedElement.style.transitionDelay = `${index * 0.25}s`; // Increased stagger nested items
                        nestedElement.classList.add('visible');
                        // Animate text within these nested elements
                        nestedElement.querySelectorAll('.text-animate-in').forEach((nestedText, nestedIndex) => {
                            nestedText.style.transitionDelay = `${(index * 0.25) + (nestedIndex * 0.07)}s`; // Increased stagger text within nested items
                            nestedText.classList.add('visible');
                        });
                    });

                    // Only unobserve if the animation is a one-time thing per load
                    observer.unobserve(entry.target);
                } else {
                    // Optional: remove 'visible' class if you want elements to re-animate when scrolled back into view
                    // entry.target.classList.remove('visible');
                    // entry.target.querySelectorAll('.text-animate-in').forEach(textElement => textElement.classList.remove('visible'));
                    // entry.target.querySelectorAll('.feature-item, .roadmap-phase').forEach(nestedElement => {
                    //     nestedElement.classList.remove('visible');
                    //     nestedElement.querySelectorAll('.text-animate-in').forEach(nestedText => nestedText.classList.remove('visible'));
                    // });
                }
            });
        }, observerOptions);

        // Observe all relevant sections for animation
        document.querySelectorAll('.section-animate-in, .feature-item, .roadmap-phase').forEach(section => {
            sectionObserver.observe(section);
        });


        // --- Initial Setup on Load ---
        document.addEventListener('DOMContentLoaded', () => {
            const loadingScreen = document.getElementById('loading-screen');
            const loadingProgressFill = document.getElementById('loading-progress-fill');
            const loadingMessage = document.getElementById('loading-message');
            const messages = [
                "Initializing modules...",
                "Decrypting ancient protocols...",
                "Syncing with Solana blockchain...",
                "Loading character data...",
                "Compiling battle algorithms...",
                "Establishing secure connection...",
                "Ready for battle!",
            ];
            let messageIndex = 0;
            let progress = 0;

            loadingScreen.style.display = 'flex';

            const updateLoading = () => {
                if (progress < 100) {
                    progress += 100 / (messages.length * 3); // Increment progress even slower (was * 2)
                    loadingProgressFill.style.width = `${progress}%`;
                    if (messageIndex < messages.length -1 && progress >= (100 / messages.length) * (messageIndex + 1)) {
                         messageIndex++;
                         loadingMessage.textContent = messages[messageIndex];
                    }
                    setTimeout(updateLoading, 300); // Update every 300ms (was 200ms)
                } else {
                    loadingMessage.textContent = messages[messages.length - 1]; // Ensure final message
                    setTimeout(() => {
                        initializeOwnedCards();
                        updateSLUGDisplay();

                        const homePage = document.getElementById('home');
                        homePage.classList.add('active');
                        document.querySelector('.nav-link[data-page="home"]').classList.add('active');

                        homePage.querySelectorAll('.section-animate-in, .feature-item, .roadmap-phase').forEach((section) => {
                            if (section.getBoundingClientRect().top < window.innerHeight) {
                                section.classList.add('visible');
                                section.querySelectorAll('.text-animate-in').forEach((textElement) => {
                                    textElement.classList.add('visible');
                                });
                            }
                        });

                        loadingScreen.classList.add('fade-out');
                        loadingScreen.addEventListener('transitionend', () => {
                            loadingScreen.style.display = 'none';
                        }, { once: true }); // Use {once: true} to remove listener after first call
                    }, 500); // Small delay after progress completes
                }
            };

            updateLoading();
        });
    </script>
</body>
</html>
