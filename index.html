<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SolBattles â€“ Stake. Battle. Earn.</title>
    <!-- UPDATED FONT: Using only Rajdhani for a uniform look -->
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- GSAP Library CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/ScrollTrigger.min.js"></script>
    <style>
        /* --- NEW CLEANER CURSOR --- */
        body {
            cursor: none; /* Hide default cursor */
        }

        #custom-cursor {
            position: fixed;
            width: 20px;
            height: 20px;
            border: 2px solid white;
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
            transform: translate(-50%, -50%);
            transition: transform 0.1s ease-out;
        }

        #custom-cursor::after {
            content: '';
            position: absolute;
            width: 6px;
            height: 6px;
            background-color: var(--solana-green);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 10px var(--solana-green);
        }

        body:hover #custom-cursor {
            transform: translate(-50%, -50%) scale(1.1);
        }
        
        /* --- REVAMPED LOADING SCREEN --- */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--primary-bg);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 1;
            transition: opacity 1.5s ease-out, visibility 1.5s;
            visibility: visible;
        }

        #loading-screen.fade-out {
            opacity: 0;
            visibility: hidden;
        }

        .loading-container {
            text-align: center;
        }

        .loading-title {
            font-family: 'Rajdhani', sans-serif; /* UNIFIED FONT */
            font-weight: 700;
            color: var(--solana-green);
            font-size: clamp(2.5rem, 10vw, 4.5rem);
            text-shadow: 0 0 15px var(--solana-green), 0 0 30px rgba(60, 230, 188, 0.5);
            animation: loadingPulse 2.5s infinite alternate cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 4px;
        }

        @keyframes loadingPulse {
            from {
                transform: scale(0.98);
                opacity: 0.8;
                text-shadow: 0 0 10px var(--solana-green), 0 0 20px rgba(60, 230, 188, 0.3);
            }
            to {
                transform: scale(1);
                opacity: 1;
                text-shadow: 0 0 25px var(--solana-green), 0 0 50px rgba(60, 230, 188, 0.7);
            }
        }

        .loading-text {
            font-family: 'Rajdhani', sans-serif;
            color: var(--text-color);
            font-size: 1.2rem;
            margin-top: 20px;
            letter-spacing: 2px;
            animation: flicker 2s infinite alternate;
        }

        @keyframes flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* General Styling */
        :root {
            --primary-bg: #1a1a2e;
            --secondary-bg: #16213e;
            --card-bg: #0f3460;
            --text-color: #e0e0e0;
            --highlight-color: #e94560;
            --button-bg: #533483;
            --button-hover: #e94560;
            --glow-color: #8a2be2;
            --border-color: #0c7b93;
            --dark-border: #0a1128;
            --solana-purple: #925FE2;
            --solana-blue: #4DCFFD;
            --solana-green: #3CE6BC;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
        }

        body {
            /* UNIFIED FONT: Using Rajdhani for everything */
            font-family: 'Rajdhani', sans-serif;
            font-weight: 500;
            background-color: var(--primary-bg);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            line-height: 1.7;
            overflow-x: hidden;
            position: relative;
            font-size: 1rem;
        }
        
        main {
            /* ADDED PADDING: Prevents content from being hidden by the sticky nav bar */
             padding-top: 80px;
        }

        /* Subtle background particles/glows */
        body::before, body::after {
            content: '';
            position: fixed;
            width: 150px;
            height: 150px;
            background: radial-gradient(circle, var(--solana-purple) 0%, transparent 70%);
            border-radius: 50%;
            opacity: 0.1;
            filter: blur(50px);
            animation: moveLight1 15s infinite alternate;
            z-index: -1;
        }

        body::after {
            width: 120px;
            height: 120px;
            background: radial-gradient(circle, var(--solana-blue) 0%, transparent 70%);
            animation: moveLight2 20s infinite alternate;
        }

        @keyframes moveLight1 { 0% { top: 10%; left: 10%; } 50% { top: 80%; left: 70%; } 100% { top: 10%; left: 10%; } }
        @keyframes moveLight2 { 0% { top: 80%; left: 20%; } 50% { top: 10%; left: 80%; } 100% { top: 80%; left: 20%; } }

        .container {
            width: 95%; /* Adjusted from 90% */
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px 10px;
            box-sizing: border-box;
        }

        h1, h2, h3, h4 {
            /* UNIFIED FONT */
            font-family: 'Rajdhani', sans-serif;
            font-weight: 700;
            color: var(--highlight-color);
            text-align: center;
            margin-bottom: 1.25rem;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        h2 { font-size: 2.5rem; }
        h3 { font-size: 1.8rem; color: var(--solana-blue); }
        h4 { font-size: 1.2rem; }

        p, ul {
            font-family: 'Rajdhani', sans-serif;
            margin-bottom: 0.625rem;
            font-size: 1.1rem;
        }

        a {
            color: var(--highlight-color);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        a:hover {
            color: var(--glow-color);
        }

        /* --- NEW TOP STICKY HEADER --- */
        header {
            background-color: rgba(26, 26, 46, 0.85); /* Slightly darker */
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(12, 123, 147, 0.5);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
            position: sticky; /* CHANGED from fixed */
            top: 0; /* Stick to top */
            z-index: 1000;
            width: 100%;
            padding: 0; /* Let container handle padding */
            transition: all 0.3s ease;
        }
        
        header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
            padding: 10px;
            height: 60px; /* Set a fixed height */
        }

        header h1 {
            margin: 0;
            font-size: 1.8rem;
            white-space: nowrap;
        }

        nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
        }

        nav li {
            margin: 0 0.8rem;
        }

        nav a {
            color: var(--text-color);
            font-weight: bold;
            padding: 0.3125rem 0;
            position: relative;
            transition: color 0.3s ease, transform 0.3s ease;
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        nav a::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            background: var(--highlight-color);
            left: 50%;
            transform: translateX(-50%);
            bottom: -0.3125rem;
            transition: width 0.3s ease;
        }

        nav a:hover::after,
        nav a.active::after {
            width: 100%;
        }

        nav a:hover {
            color: var(--highlight-color);
        }

        .glow-button {
            background-color: var(--button-bg);
            color: var(--text-color);
            border: none;
            padding: 0.625rem 1.25rem;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Rajdhani', sans-serif; /* UNIFIED FONT */
            font-weight: 700;
            font-size: 1rem;
            text-transform: uppercase;
            box-shadow: 0 0 10px var(--glow-color);
            transition: all 0.3s ease;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
        }

        .glow-button:hover {
            background-color: var(--button-hover);
            box-shadow: 0 0 15px var(--glow-color), 0 0 30px var(--glow-color);
            transform: scale(1.05);
        }

        .glow-button:disabled {
            background-color: #333;
            box-shadow: none;
            cursor: not-allowed;
            opacity: 0.6;
            transform: none;
        }

        /* Wallet Status Display */
        #walletStatus {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
            color: var(--text-color);
            flex-wrap: nowrap;
            justify-content: center;
        }

        #walletStatus.connected .status-dot {
            background-color: var(--solana-green);
            box-shadow: 0 0 8px var(--solana-green);
        }

        #walletStatus.connecting .status-dot {
            background-color: orange;
            animation: pulse 1s infinite alternate;
        }

        .status-dot {
            width: 0.625rem;
            height: 0.625rem;
            border-radius: 50%;
            background-color: grey;
            margin-right: 0.5rem;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }
        #walletAddress {
            font-family: 'Rajdhani', sans-serif;
            font-weight: 700;
            font-size: 0.9rem;
            margin-left: 0.625rem;
            color: var(--solana-blue);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 9.375rem;
        }
        #slugBalanceDisplay {
            margin-left: 0.9375rem;
            font-weight: bold;
            color: var(--solana-green);
            white-space: nowrap;
            font-family: 'Rajdhani', sans-serif;
            font-size: 1rem;
        }


        /* Main Content Sections */
        .page {
            display: none;
            padding: 2.5rem 0;
            width: 100%;
            /* NEW: Centralize content within the page */
            display: flex; /* Changed from none to flex by JS when active */
            flex-direction: column;
            align-items: center; /* Centers children horizontally */
        }

        .page:not(.active) { /* Hide pages that are not active */
            display: none;
        }

        .page.active {
            display: flex;
        }


        /* General Section Animation */
        .section-animate-in {
            /* Removed opacity: 0 and transform for initial state from CSS */
            /* GSAP will handle initial hiding and animation */
            transition: none; /* Ensure no CSS transitions interfere with GSAP */
        }

        /* Text Specific Animation */
        .text-animate-in {
            /* Removed opacity: 0 and transform for initial state from CSS */
            /* GSAP will handle initial hiding and animation */
            transition: none; /* Ensure no CSS transitions interfere with GSAP */
        }

        /* --- HOMEPAGE HERO WITH PARALLAX AND TEXT EFFECTS --- */
        .hero {
            padding: 4rem 1.25rem; /* Adjusted padding for better fit */
            text-align: center;
            border-radius: 15px; /* Slightly more rounded */
            margin-bottom: 2.5rem;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.8);
            animation: heroGlow 2s infinite alternate; /* Kept for overall glow */
            background-attachment: fixed;
            background-position: center 0;
            position: relative; /* For absolute positioning of hero-visuals */
            overflow: hidden; /* Ensure floating cards don't spill */
            background-size: cover; /* Make sure image covers the area */
        }

        @keyframes heroGlow {
            from { box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.8), 0 0 10px rgba(138, 43, 226, 0.3); }
            to { box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.9), 0 0 20px rgba(138, 43, 226, 0.7); }
        }
        /* New for more reactive background */
        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* Increased opacity for visibility */
            background: radial-gradient(circle at var(--mouse-x, 50%) var(--mouse-y, 50%), rgba(77, 207, 253, 0.3) 0%, transparent 40%); /* Stronger, smaller gradient */
            pointer-events: none;
            z-index: 1; /* Above background, below text */
            transition: background 0.1s linear; /* Smooth mouse follow */
        }
        .hero::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 70% 30%, var(--solana-green) 0%, transparent 50%),
                        radial-gradient(circle at 30% 80%, var(--solana-purple) 0%, transparent 50%);
            opacity: 0.12; /* Subtle constant glow, slightly increased */
            filter: blur(30px);
            animation: backgroundPulse 5s infinite alternate;
            z-index: 0; /* Below ::before */
        }

        @keyframes backgroundPulse {
            0% { opacity: 0.12; transform: scale(1); }
            100% { opacity: 0.15; transform: scale(1.02); }
        }
        
        .hero h2, .hero p {
            opacity: 1;
            position: relative; /* Ensure text is above ::before and ::after pseudo-elements */
            z-index: 2;
        }
        
        .hero h2 .char, .hero p .char {
            display: inline-block;
            opacity: 0;
            transform: translateY(20px) scale(0.5);
            transition: opacity 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .hero h2 {
            font-size: clamp(2.8rem, 5.5vw, 4.5rem); /* Slightly reduced max font size */
            margin-bottom: 1rem;
            line-height: 1.1;
            color: var(--solana-green); /* Changed hero title color for more impact */
            text-shadow: 0 0 20px var(--solana-green), 0 0 40px rgba(60, 230, 188, 0.5); /* Stronger glow */
            min-height: 50px;
        }

        .hero p {
            font-size: clamp(1.1rem, 2.3vw, 1.5rem); /* Slightly reduced max font size */
            max-width: 45rem; /* Slightly narrower */
            color: var(--text-color); /* Stronger contrast */
            margin: 0 auto 2.5rem auto; /* Space before buttons */
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
            min-height: 80px;
        }

        .hero-actions {
            display: flex;
            justify-content: center;
            gap: 1.5rem; /* Space between buttons */
            margin-top: 2rem;
            position: relative; /* Ensure buttons are above pseudo-elements */
            z-index: 2;
        }

        .large-button {
            padding: 0.8rem 2rem;
            font-size: 1.2rem;
        }

        .inverted-button {
            background-color: transparent;
            border: 2px solid var(--highlight-color);
            box-shadow: none;
            color: var(--highlight-color);
            transition: all 0.3s ease;
        }

        .inverted-button:hover {
            background-color: var(--highlight-color);
            color: var(--primary-bg);
            box-shadow: 0 0 15px var(--highlight-color);
            transform: scale(1.05);
        }

        /* Hero Floating Visuals */
        .hero-visuals {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            overflow: hidden;
            z-index: 1; /* Below text, above static background */
        }

        .floating-card {
            position: absolute;
            opacity: 0.2; /* Subtle */
            /* Removed CSS animation to be replaced by GSAP */
            filter: drop-shadow(0 0 10px rgba(0,0,0,0.5));
            border-radius: 5px;
            object-fit: contain;
        }

        .card-1 { top: 15%; left: 5%; width: 80px; height: 100px; }
        .card-2 { top: 70%; right: 80%; width: 90px; height: 110px; }
        .card-3 { top: 40%; left: 20%; width: 70px; height: 70px; border-radius: 50%; object-fit: cover; }

        /* @keyframes float is now handled by GSAP */

        /* --- NEW STATS SECTION --- */
        .stats-section {
            background-color: var(--secondary-bg);
            border-radius: 10px;
            padding: 2.5rem 1.5rem;
            margin-bottom: 2.5rem;
            text-align: center;
            border: 2px solid var(--border-color);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center; /* Center content within section */
            align-items: center;
            min-height: 150px; /* Ensure visibility for animation */
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            width: 100%;
            max-width: 900px; /* Control max width of stats */
        }

        .stat-item {
            background-color: var(--card-bg);
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid rgba(12, 123, 147, 0.5);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            /* opacity: 0; Removed, handled by GSAP. */
            /* transform: translateY(20px); Removed, handled by GSAP. */
        }

        /* Removed .visible class for stat-item as GSAP will control opacity/transform */

        .stat-item:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 0 20px var(--solana-purple);
        }

        .stat-value {
            font-size: clamp(2.2rem, 4vw, 3.5rem);
            font-weight: 700;
            color: var(--solana-green);
            display: block;
            margin-bottom: 0.5rem;
            text-shadow: 0 0 10px var(--solana-green);
        }

        .stat-label {
            font-size: 1.1rem;
            color: #ccc;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        /* Adjust existing styles for better flow */
        .about-section {
            padding-top: 3rem; /* More space */
            padding-bottom: 3rem;
            text-align: center; /* Ensure text is centered */
        }
        .about-section h3 {
            font-size: clamp(2rem, 4vw, 3rem); /* Larger and more impactful */
            color: var(--solana-blue);
            margin-bottom: 1.5rem;
            text-shadow: 0 0 10px rgba(77, 207, 253, 0.5);
        }
        .about-section p {
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            font-size: 1.2rem;
            line-height: 1.8;
        }
        .about-section .primary-button { /* New class for prominent buttons */
            background-color: var(--highlight-color);
            box-shadow: 0 0 15px var(--highlight-color);
            margin-top: 2rem;
        }
        .about-section .primary-button:hover {
            box-shadow: 0 0 25px var(--highlight-color), 0 0 40px var(--highlight-color);
        }

        .roadmap-section h3 { /* Used for Features and Roadmap titles */
            font-size: clamp(2rem, 4vw, 3rem);
            color: var(--solana-blue); /* Consistent with About */
            margin-top: 3rem;
            margin-bottom: 2rem;
            text-shadow: 0 0 10px rgba(77, 207, 253, 0.5);
        }


        /* Game Features Section */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-top: 40px;
            padding-bottom: 40px;
            text-align: center;
        }

        .feature-item {
            background-color: var(--card-bg);
            padding: 25px;
            border-radius: 10px;
            border: 2px solid var(--border-color);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.6);
            /* opacity: 0; Removed, handled by GSAP. */
            /* transform: scale(0.8); Removed, handled by GSAP. */
            transition: box-shadow 0.3s ease; /* Keep hover effect */
        }

        /* Removed .visible for feature-item */

        .feature-item:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 0 25px var(--glow-color);
        }

        .feature-item svg {
            width: 50px;
            height: 50px;
            margin-bottom: 15px;
            fill: var(--highlight-color);
            transition: fill 0.3s ease;
        }

        .feature-item:hover svg {
            fill: var(--text-color);
        }

        .feature-item p {
            font-size: 1rem;
            color: #ccc;
        }


        /* Roadmap Section */
        .roadmap-timeline {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 30px;
        }

        .roadmap-phase {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            border-left: 5px solid var(--highlight-color);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.4);
            position: relative;
            /* opacity: 0; Removed, handled by GSAP. */
            /* transform: translateX(-50px); Removed, handled by GSAP. */
            transition: border-left-color 0.3s ease; /* Keep color transition */
        }
        /* Removed .visible for roadmap-phase */
        .roadmap-phase:nth-child(odd) { border-left-color: var(--solana-green); }
        .roadmap-phase:nth-child(even) { border-left-color: var(--solana-blue); }

        .roadmap-phase ul { list-style: disc inside; margin-left: 15px; color: #ccc; }
        .roadmap-phase ul li { margin-bottom: 5px; }


        /* Docs Section */
        .docs-section { text-align: center; }
        .docs-section p { font-size: 1.1rem; margin-bottom: 20px; }
        .docs-section .glow-button { display: inline-block; margin-top: 10px; }

        /* Card Styling (Reusable) */
        .card {
            background-color: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 10px;
            padding: 0.9375rem;
            text-align: center;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.6);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .card:hover { transform: translateY(-0.3125rem); box-shadow: 0 0 25px var(--glow-color); }

        .card.selected { border-color: var(--glow-color); box-shadow: 0 0 30px var(--glow-color), 0 0 10px var(--highlight-color); transform: translateY(-0.5rem); }

        .card img { width: 100%; max-width: 11.25rem; height: auto; border-radius: 8px; margin-bottom: 0.625rem; border: 1px solid var(--dark-border); object-fit: cover; }
        
        .card p { font-size: 0.9rem; margin: 0.3125rem 0; }

        .card-stats { display: flex; flex-wrap: wrap; justify-content: center; gap: 0.3125rem; margin-top: 0.625rem; font-size: 0.8rem; }
        .card-stat { background-color: rgba(0, 0, 0, 0.3); padding: 0.1875rem 0.5rem; border-radius: 3px; white-space: nowrap; }

        .rarity { font-weight: bold; text-transform: uppercase; margin-top: 0.3125rem; }
        .rarity.common { color: #aaa; }
        .rarity.rare { color: #00bfff; }
        .rarity.epic { color: #8a2be2; }
        .rarity.legendary { color: #ffd700; }


        /* Grids */
        .card-grid, .shop-grid, .my-deck-grid, .revealed-cards-grid, .card-selection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(12.5rem, 1fr));
            gap: 1.25rem;
            padding: 1.25rem 0;
        }

        /* Arena Page */
        .arena-setup { text-align: center; }
        .wallet-stake-input { margin-bottom: 1.25rem; font-size: 1.1rem; }
        .wallet-stake-input input { width: 6.25rem; padding: 0.5rem; border-radius: 5px; border: 1px solid var(--border-color); background-color: var(--card-bg); color: var(--text-color); font-family: 'Rajdhani', sans-serif; margin-left: 0.625rem; }
        .card-selection-grid .card { cursor: pointer; }
        .battle-results-box { text-align: center; }

        /* New Battle UI styles */
        .battle-ui {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 30px;
            background-color: var(--secondary-bg);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid var(--border-color);
            box-shadow: 0 0 25px rgba(0,0,0,0.8);
            text-align: center;
            width: 100%; /* Ensure it takes full width of its centered parent */
            max-width: 900px; /* Limit overall battle UI width */
        }
        .player-area, .opponent-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        .player-area h4, .opponent-area h4 {
            color: var(--solana-green);
            font-size: 1.5rem;
            margin-bottom: 10px;
        }
        .current-card-display {
            width: 150px; /* Fixed size for current card */
            height: 220px;
            background-color: var(--card-bg);
            border: 2px solid var(--highlight-color);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            box-shadow: 0 0 15px var(--glow-color);
            transition: transform 0.3s ease;
        }
        .current-card-display img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }
        .current-card-display.player-card { border-color: var(--solana-green); box-shadow: 0 0 15px var(--solana-green); }
        .current-card-display.opponent-card { border-color: var(--solana-purple); box-shadow: 0 0 15px var(--solana-purple); }

        .health-bar-container {
            width: 80%;
            max-width: 300px;
            background-color: #333;
            border: 1px solid #555;
            border-radius: 5px;
            height: 20px;
            margin-top: 10px;
            overflow: hidden;
        }
        .health-bar {
            height: 100%;
            width: 100%; /* Initial width */
            background-color: var(--solana-green);
            transition: width 0.5s ease-out, background-color 0.5s ease-out;
        }
        .health-bar.opponent-hp { background-color: var(--solana-purple); }
        .health-bar.low-hp { background-color: #e94560; } /* Red for low health */


        .opponent-deck-display {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }
        .opponent-deck-card {
            width: 50px;
            height: 70px;
            background-color: var(--card-bg);
            border: 1px solid var(--dark-border);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-color);
            font-size: 0.8rem;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
        }
        .battle-action-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }


        .battle-log {
            background-color: var(--card-bg); border: 1px solid var(--dark-border); border-radius: 8px;
            padding: 0.9375rem; max-height: 15.625rem; overflow-y: auto; text-align: left;
            margin-bottom: 1.25rem; font-size: 0.9rem; line-height: 1.8;
            scrollbar-width: thin; scrollbar-color: var(--highlight-color) var(--card-bg);
        }
        .battle-log::-webkit-scrollbar { width: 8px; }
        .battle-log::-webkit-scrollbar-track { background: var(--card-bg); border-radius: 10px; }
        .battle-log::-webkit-scrollbar-thumb { background-color: var(--highlight-color); border-radius: 10px; border: 2px solid var(--card-bg); }
        .battle-log p { margin-bottom: 0.3125rem; animation: slideIn 0.5s ease-out; }

        @keyframes slideIn { from { opacity: 0; transform: translateX(-1.25rem); } to { opacity: 1; transform: translateX(0); } }
        .battle-log p:nth-child(even) { color: #ccc; }
        .battle-log p strong { color: var(--highlight-color); }
        .battle-log p.winner-message { color: #4CAF50; font-weight: bold; }
        .battle-log p.loser-message { color: #F44336; font-weight: bold; }
        .battle-log p.system-message { color: var(--solana-blue); font-style: italic; }

        #battleWinner { color: #4CAF50; font-size: 1.8rem; margin-bottom: 0.3125rem; animation: winnerGlow 1s infinite alternate; }
        #battleLoser { color: #F44336; font-size: 1.2rem; }
        @keyframes winnerGlow { from { text-shadow: 0 0 5px #4CAF50; } to { text-shadow: 0 0 15px #4CAF50, 0 0 30px #4CAF50; } }

        /* Shop Page specific styles */
        .shop-content { 
            display: flex; 
            flex-direction: column; 
            gap: 20px; 
            align-items: center; /* Ensures shop content is centered within its flex parent */
            width: 100%; /* Take full width of its container */
            max-width: 900px; /* Limit overall shop content width */
        }
        .shop-pack-section { text-align: center; width: 100%; box-sizing: border-box; }
        #packOpeningAnimation {
            text-align: center; margin-top: 1.875rem; padding: 1.875rem; background-color: var(--secondary-bg);
            border-radius: 10px; border: 1px solid var(--border-color); box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            width: 100%; /* Take full width of its centered parent */
            max-width: 600px; /* Limit animation box width */
        }
        .pack-image { width: 12.5rem; height: 12.5rem; object-fit: contain; animation: bounce 1s infinite alternate; filter: drop-shadow(0 0 10px var(--glow-color)); }
        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-0.9375rem); } }
        .reveal-message { font-size: 1.5rem; margin-top: 1.25rem; color: var(--text-color); animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }

        .card-flip-container { position: relative; width: 12.5rem; height: 18.75rem; transform-style: preserve-3d; transition: transform 0.8s; margin: 0 auto; }
        .card-front, .card-back {
            position: absolute; width: 100%; height: 100%; backface-visibility: hidden;
            border-radius: 10px; display: flex; flex-direction: column; justify-content: space-between;
            align-items: center; padding: 0.9375rem; box-sizing: border-box;
            border: 2px solid var(--border-color); background-color: var(--card-bg);
        }
        .card-front { z-index: 2; transform: rotateY(0deg); }
        .card-front img { width: 100%; height: 100%; object-fit: cover; border-radius: 8px; }
        .card-back {
            background-color: var(--button-bg); border: 2px solid var(--glow-color); transform: rotateY(180deg);
            display: flex; justify-content: center; align-items: center;
            font-size: 2rem; color: var(--text-color); box-shadow: 0 0 15px rgba(0, 0, 0, 0.6);
        }
        .card-back::before {
            content: "SLUG"; font-family: 'Rajdhani', sans-serif; opacity: 0.2;
            font-size: 3rem; position: absolute; z-index: 1;
        }
        .card-back img { max-width: 11.25rem; height: auto; border-radius: 8px; margin-bottom: 0.625rem; border: 1px solid var(--dark-border); object-fit: cover; z-index: 2; }
        .card-back h4, .card-back p, .card-back .card-stats { z-index: 2; }
        
        /* Shop Grid */
        .shop-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(12.5rem, 1fr)); gap: 1.25rem; padding: 1.25rem 0; width: 100%; }
        .shop-grid .card .buy-button { margin-top: 0.9375rem; width: calc(100% - 1.875rem); bottom: 0.9375rem; left: 0.9375rem; position: relative; }
        .shop-grid .card { display: flex; flex-direction: column; justify-content: space-between; }

        /* My Deck Page */
        .deck-controls { text-align: right; margin-bottom: 1.25rem; width: 100%; max-width: 900px; /* Match other content blocks */ }
        .deck-controls label { margin-right: 0.625rem; font-size: 1.1rem; }
        .deck-controls select { padding: 0.5rem; border-radius: 5px; border: 1px solid var(--border-color); background-color: var(--card-bg); color: var(--text-color); font-family: 'Rajdhani', sans-serif; min-width: 9.375rem; }
        .my-deck-grid .card { cursor: pointer; }
        .card-detail-popup { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.8); display: flex; justify-content: center; align-items: center; z-index: 2000; }
        .card-detail-content {
            background-color: var(--secondary-bg); padding: 1.875rem; border-radius: 10px;
            border: 2px solid var(--glow-color); box-shadow: 0 0 20px var(--glow-color);
            text-align: center; max-width: 25rem; width: 90%; position: relative; animation: popIn 0.3s ease-out;
        }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .card-detail-content .close-popup { position: absolute; top: 0.625rem; right: 0.9375rem; font-size: 1.8rem; cursor: pointer; color: var(--text-color); }
        .card-detail-content .close-popup:hover { color: var(--highlight-color); }
        .card-detail-content img { max-width: 12.5rem; border-radius: 8px; margin-bottom: 0.9375rem; border: 1px solid var(--dark-border); }
        .card-detail-content h3 { margin-top: 0; font-size: 1.5rem; }
        .card-detail-content p { font-size: 1rem; margin: 0.3125rem 0; }
        .card-actions { margin-top: 1.25rem; display: flex; justify-content: space-around; flex-wrap: wrap; gap: 0.625rem; }
        /* New style for generated lore */
        .card-lore {
            background-color: rgba(0,0,0,0.2);
            border-left: 3px solid var(--solana-green);
            padding: 10px;
            margin-top: 15px;
            font-size: 0.95rem;
            text-align: left;
            border-radius: 5px;
            color: #ccc;
            font-style: italic;
            line-height: 1.5;
        }


        /* Leaderboard Page */
        .leaderboard-table-container { 
            overflow-x: auto; 
            width: 100%; /* Take full width of its centered parent */
            max-width: 900px; /* Limit overall table width */
        }
        #leaderboardTable { width: 100%; border-collapse: collapse; margin-bottom: 1.25rem; white-space: nowrap; }
        #leaderboardTable th, #leaderboardTable td { padding: 0.75rem 0.9375rem; text-align: left; border-bottom: 1px solid var(--dark-border); transition: background-color 0.2s ease; }
        #leaderboardTable th { background-color: var(--card-bg); color: var(--highlight-color); font-family: 'Rajdhani', sans-serif; font-weight: 700; font-size: 0.9rem; text-transform: uppercase; }
        #leaderboardTable tbody tr:nth-child(even) { background-color: rgba(0, 0, 0, 0.2); }
        #leaderboardTable tbody tr:hover { background-color: rgba(0, 0, 0, 0.4); transform: scale(1.01); transition: all 0.2s ease; }
        #leaderboardTable tbody tr { animation: fadeInRow 0.5s ease-out; }
        @keyframes fadeInRow { from { opacity: 0; transform: translateY(0.625rem); } to { opacity: 1; transform: translateY(0); } }
        .leaderboard-table-container .rank-change { display: inline-block; margin-left: 0.3125rem; font-size: 0.8rem; font-weight: bold; opacity: 0; transform: translateY(0.625rem); animation: rankChangeEffect 0.5s forwards; }
        .rank-change.up { color: var(--solana-green); }
        .rank-change.down { color: #F44336; }
        .rank-change.new { color: var(--solana-blue); }
        @keyframes rankChangeEffect { from { opacity: 0; transform: translateY(0.625rem); } to { opacity: 1; transform: translateY(0); } }
        .weekly-update-note { text-align: center; font-style: italic; color: #aaa; margin-top: 1.25rem; }

        /* Token Page */
        .token-info {
            width: 100%;
            max-width: 800px; /* Limit token info width */
        }
        .token-info ul { list-style: disc inside; margin-left: 1.25rem; margin-bottom: 1.25rem; }
        .token-info ul li { margin-bottom: 0.5rem; }
        .token-info p { margin-bottom: 0.625rem; }
        .token-actions { text-align: center; margin-top: 1.875rem; display: flex; justify-content: center; gap: 1.25rem; flex-wrap: wrap; }
        .coming-soon-badge { display: inline-block; background-color: var(--solana-purple); color: white; padding: 0.25rem 0.5rem; border-radius: 5px; font-size: 0.7rem; margin-left: 0.625rem; animation: pulse 1s infinite alternate; }

        /* Footer */
        footer {
            background-color: var(--secondary-bg); padding: 1.25rem 0; text-align: center;
            border-top: 2px solid var(--border-color); margin-top: 2.5rem; box-shadow: 0 -4px 8px rgba(0, 0, 0, 0.4);
        }
        footer p { margin: 0; color: #aaa; font-size: 0.9rem; }

        /* Universal Popup */
        .universal-popup { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.85); display: flex; justify-content: center; align-items: center; z-index: 3000; }
        .universal-popup-content {
            background-color: var(--secondary-bg); padding: 2.5rem; border-radius: 10px;
            border: 2px solid var(--highlight-color); box-shadow: 0 0 25px var(--glow-color);
            text-align: center; max-width: 28.125rem; width: 90%; position: relative; animation: popIn 0.3s ease-out;
        }
        .universal-popup-content .close-universal-popup { position: absolute; top: 0.625rem; right: 0.9375rem; font-size: 1.8rem; cursor: pointer; color: var(--text-color); }
        .universal-popup-content .close-universal-popup:hover { color: var(--highlight-color); }
        .universal-popup-content p { font-size: 1.2rem; margin-bottom: 1.5625rem; color: var(--text-color); }

        /* Responsive Design */
        @media (max-width: 992px) {
            header .container { justify-content: center; }
            header h1 { display: none; } /* Hide title on tablets to save space */
        }
        @media (max-width: 768px) {
            html { font-size: 14px; }
            nav li:nth-child(n+5) { display: none; } /* Hide more nav links */
            header .container { height: 50px; }
            main { padding-top: 60px; }
            .hero h2 { font-size: 2.5rem; }
            .hero p { font-size: 1.1rem; }
            .card-grid, .shop-grid, .my-deck-grid, .revealed-cards-grid, .card-selection-grid { grid-template-columns: repeat(auto-fit, minmax(9.375rem, 1fr)); }
            
            /* Responsive adjustments for new elements */
            .hero-actions {
                flex-direction: column;
                gap: 1rem;
            }
            .large-button {
                width: 80%; /* Make buttons full width on small screens */
                margin: 0 auto;
            }
            .stats-grid {
                grid-template-columns: 1fr; /* Stack stats vertically */
            }
            .stat-item {
                padding: 1rem;
            }
            .stat-value {
                font-size: 2.5rem;
            }
            .stat-label {
                font-size: 1rem;
            }
            .battle-ui {
                padding: 15px;
                gap: 10px;
            }
            .current-card-display {
                width: 100px;
                height: 150px;
            }
        }
        @media (max-width: 600px) {
            html { font-size: 12px; }
            nav ul { display: none; } /* Hide nav on small screens, can be replaced with a menu button */
            #walletStatus { display: none; }
            header .container { justify-content: space-between; }
            header h1 { display: block; font-size: 1.5rem; } /* Show title again if nav is gone */
            .hero { padding: 3.125rem 0.625rem; }
            .hero h2 { font-size: 2rem; }
            .hero p { font-size: 1rem; }
            .about-section h3, .roadmap-section h3 {
                font-size: 2rem;
            }
            .about-section p {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div id="custom-cursor"></div>
    
    <div id="loading-screen">
        <div class="loading-container">
            <div class="loading-title">SOLBATTLES</div>
            <div class="loading-text" id="loading-message">Initializing...</div>
        </div>
    </div>

    <header>
        <div class="container">
            <h1>SolBattles</h1>
            <nav>
                <ul>
                    <li><a href="#home" class="nav-link active" data-page="home">Home</a></li>
                    <li><a href="#arena" class="nav-link" data-page="arena">Arena</a></li>
                    <li><a href="#shop" class="nav-link" data-page="shop">Shop</a></li>
                    <li><a href="#my-deck" class="nav-link" data-page="my-deck">My Deck</a></li>
                    <li><a href="#leaderboard" class="nav-link" data-page="leaderboard">Leaderboard</a></li>
                    <li><a href="#token" class="nav-link" data-page="token">Token</a></li>
                    <li><a href="#docs" class="nav-link" data-page="docs">Docs</a></li>
                </ul>
            </nav>
            <div style="display: flex; align-items: center; gap: 15px;">
                <div id="walletStatus" style="display: none;">
                    <span class="status-dot"></span>
                    <span id="walletAddress"></span>
                    <span id="slugBalanceDisplay"></span>
                </div>
                <button id="connectWalletBtn" class="glow-button">Connect</button>
            </div>
        </div>
    </header>

    <main>
        <!-- Homepage Section - ENHANCED -->
        <section id="home" class="page active">
            <div class="container">
                <!-- REVAMPED HERO SECTION -->
                <div class="hero" id="homeHero">
                    <h2 id="hero-title">SolBattles: Where Strategy Meets Solana.</h2>
                    <p id="hero-subtitle">Dive into the decentralized card game. Collect unique NFTs, challenge opponents, and earn real rewards on the blockchain.</p>
                    <div class="hero-actions">
                        <button id="heroConnectWalletBtn" class="glow-button large-button">Connect Wallet to Play</button>
                        <button id="heroLearnMoreBtn" class="glow-button inverted-button">Learn More</button>
                    </div>
                    <!-- Optional: Small visual elements like floating card icons -->
                    <div class="hero-visuals">
                        <img src="https://pbs.twimg.com/media/Gtte3HqWIAAl65w?format=jpg&name=small" alt="Floating Card 1" class="floating-card card-1">
                        <img src="https://pbs.twimg.com/media/GuDXXlfXAAAnBgA?format=jpg&name=small" alt="Floating NFT 2" class="floating-card card-2">
                        <img src="https://pbs.twimg.com/media/GuDZ-zSWMAA8Muo?format=png&name=small" alt="Floating SLUG Coin" class="floating-card card-3">
                    </div>
                </div>

                <!-- NEW: Quick Stats / Value Proposition -->
                <div class="stats-section section-animate-in">
                    <h3 class="sr-only">Key Game Statistics</h3> <!-- Screen reader only -->
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-value" data-target="15000">0</span>+
                            <p class="stat-label">Battles Played</p>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" data-target="5000">0</span>+
                            <p class="stat-label">Unique NFTs</p>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" data-target="250000">0</span>+
                            <p class="stat-label">$SLUG Earned</p>
                        </div>
                    </div>
                </div>

                <!-- About SolBattles (Slightly rephrased and emphasized) -->
                <div class="about-section section-animate-in">
                    <h3>Unleash Your Strategy</h3>
                    <p class="text-animate-in">SolBattles is more than just a game; it's an immersive, strategic card battle experience built on the robust Solana blockchain. Collect, evolve, and deploy powerful NFT characters to dominate the arena. Every victory not only solidifies your legend but also earns you valuable $SLUG tokens. Are you ready to stake your claim?</p>
                    <button id="aboutCTA" class="glow-button primary-button section-animate-in">Discover Your Deck</button>
                </div>

                <!-- Game Features Section (Keep as is, but consider icons/illustrations) -->
                <div class="roadmap-section section-animate-in"> <!-- Renamed to features-overview or similar for clarity if not part of roadmap -->
                    <h3>Key Features</h3>
                    <div class="features-grid">
                        <div class="feature-item">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93s3.05-7.44 7-7.93V3.07c-4.52.49-8 4.31-8 9s3.48 8.51 8 9.01v-1.08zm2-17.93v1.08c3.95.49 7 3.85 7 7.93s-3.05 7.44-7 7.93v1.08c4.52-.49 8-4.31 8-9s-3.48-8.51-8-9.01zM11 15h2v2h-2zm0-4h2v3h-2zm0-4h2v2h-2z"/></svg>
                            <h4 class="text-animate-in">Decentralized Battles</h4>
                            <p class="text-animate-in">Experience fair and transparent gameplay. All battle outcomes are verifiable on the blockchain.</p>
                        </div>
                        <div class="feature-item">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 2.23L18.15 5.5 12 10.45 5.85 5.5 12 3.23zM4 6.32l7 3.5v11.23c-4.47-1.74-7-6.02-7-10.73V6.32zm16 0V11c0 4.71-2.53 8.99-7 10.73V9.82l7-3.5z"/></svg>
                            <h4 class="text-animate-in">True NFT Ownership</h4>
                            <p class="text-animate-in">Your cards are real digital assets. Collect, trade, and truly own your in-game power.</p>
                        </div>
                        <div class="feature-item">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16 11V3H8v8H2v10h20V11h-6zM10 5h4v6h-4V5zm10 14h-8v-6h8v6zM4 15h6v4H4v-4z"/></svg>
                            <h4 class="text-animate-in">Dynamic Leaderboards</h4>
                            <p class="text-animate-in">Compete globally and see your progress updated in real-time. Dominate the ranks!</p>
                        </div>
                        <div class="feature-item">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 6h-4V4c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2 2v2H4c-1.11 0-2 .89-2 2v10c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-6-2h-4v2h4V4zm6 14H4V8h16v10zM12 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
                            <h4 class="text-animate-in">Full $SLUG Utility</h4>
                            <p class="text-animate-in">$SLUG powers every aspect of the game, from card acquisition to high-stakes battles.</p>
                        </div>
                    </div>
                </div>

                <!-- Roadmap Section (Keep as is) -->
                <div class="roadmap-section section-animate-in">
                    <h3>Our Journey Ahead</h3>
                    <div class="roadmap-timeline">
                        <div class="roadmap-phase">
                            <h4>Phase 1: Launch & Core Gameplay</h4>
                            <ul>
                                <li class="text-animate-in">Website Launch (Current)</li>
                                <li class="text-animate-in">Core Battle Engine Implementation</li>
                                <li class="text-animate-in">NFT Card Generation & Marketplace Integration</li>
                                <li class="text-animate-in">Basic Leaderboard System</li>
                            </ul>
                        </div>
                        <div class="roadmap-phase">
                            <h4>Phase 2: Ecosystem Expansion</h4>
                            <ul>
                                <li class="text-animate-in">Card Upgrading & Fusion Mechanics</li>
                                <li class="text-animate-in">Staking $SLUG for Rewards</li>
                                <li class="text-animate-in">Community Governance Features</li>
                                <li class="text-animate-in">Mobile App Development (Beta)</li>
                            </ul>
                        </div>
                        <div class="roadmap-phase">
                            <h4>Phase 3: Advanced Features & Partnerships</h4>
                            <ul>
                                <li class="text-animate-in">Seasonal Tournaments & Exclusive Rewards</li>
                                <li class="text-animate-in">Player-vs-Environment (PvE) Modes</li>
                                <li class="text-animate-in">Cross-Chain Compatibility (Exploration)</li>
                                <li class="text-animate-in">Major Partnerships & Collaborations</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Arena Section - EXPANDED -->
        <section id="arena" class="page">
            <div class="container">
                <h2>Arena</h2>
                <div class="arena-setup section-animate-in" id="arenaSetup">
                    <h3>Prepare for Battle!</h3>
                    <p>Select 3 cards from your deck to enter the arena. The more powerful your deck, the higher the stakes!</p>
                    <div class="wallet-stake-input">
                        Stake Amount: <input type="number" id="stakeAmount" value="50" min="10" step="10"> $SLUG
                    </div>
                    <div id="selectedCardsDisplay" class="card-grid">
                        <p style="grid-column: 1 / -1; color: #ccc;">Select your 3 battle cards below.</p>
                    </div>
                    <div style="display: flex; justify-content: center; gap: 15px; margin-top: 20px; flex-wrap: wrap;">
                        <button id="findOpponentBtn" class="glow-button primary-button" disabled>Find Opponent</button>
                        <button id="getStrategyBtn" class="glow-button" disabled>âœ¨ Get Strategy Advice</button>
                    </div>
                    <div id="strategyAdvice" class="battle-log" style="display:none; margin-top: 20px; text-align: left;"></div>
                </div>
                <h3 style="margin-top: 50px;">Your Deck</h3>
                <div id="availableCardsGrid" class="card-selection-grid"></div>

                <div id="battleDisplay" class="battle-ui section-animate-in" style="display:none;">
                    <h3>BATTLE IN PROGRESS!</h3>
                    <div style="display: flex; justify-content: space-around; align-items: flex-start; width: 100%; flex-wrap: wrap; gap: 20px;">
                        <!-- Opponent Area -->
                        <div class="opponent-area">
                            <h4>Opponent's Side</h4>
                            <div class="current-card-display opponent-card" id="opponentCurrentCard">
                                <img src="${CARD_BACK_IMAGE}" alt="Opponent Card">
                            </div>
                            <div class="health-bar-container"><div class="health-bar opponent-hp" id="opponentHealthBar" style="width: 100%;"></div></div>
                            <div class="opponent-deck-display" id="opponentDeckDisplay">
                                <!-- Opponent card backs -->
                            </div>
                        </div>

                        <!-- VS Indicator -->
                        <div style="font-size: 3rem; font-weight: bold; color: var(--highlight-color); align-self: center;">VS</div>

                        <!-- Player Area -->
                        <div class="player-area">
                            <h4>Your Side</h4>
                            <div class="current-card-display player-card" id="playerCurrentCard">
                                <img src="${CARD_BACK_IMAGE}" alt="Your Card">
                            </div>
                            <div class="health-bar-container"><div class="health-bar" id="playerHealthBar" style="width: 100%;"></div></div>
                            <div class="player-deck-display" id="playerDeckDisplay">
                                <!-- Player active cards -->
                            </div>
                        </div>
                    </div>

                    <div class="battle-log" id="battleLog"></div>
                    <!-- "Next Round" button removed for automation -->
                </div>

                <div id="battleResults" class="battle-results-box section-animate-in" style="display:none;">
                    <h3>Battle Results</h3>
                    <p id="battleWinner"></p>
                    <p id="battleLoser"></p>
                    <button id="playAgainBtn" class="glow-button primary-button" style="margin-top: 20px;">Play Again</button>
                </div>
            </div>
        </section>

        <!-- Shop Section - IMPROVED -->
        <section id="shop" class="page">
            <div class="container shop-content">
                <h2>Shop</h2>
                <p>Acquire new card packs to strengthen your collection!</p>
                <div id="shopGridContainer">
                     <!-- Shop items rendered here by JS -->
                </div>
                <div id="packOpeningAnimation" style="display: none;">
                    <h3>Opening Pack...</h3>
                    <img src="https://pbs.twimg.com/media/GuDc5rWWEAEm5ew?format=jpg&name=small" alt="Card Pack" class="pack-image">
                    <p class="reveal-message">Click to reveal your cards!</p>
                    <div id="revealedCardsGrid" class="revealed-cards-grid" style="display: none;"></div>
                    <button id="revealCardBtn" class="glow-button primary-button" style="margin-top: 20px;">Reveal Next Card</button>
                    <button id="collectCardsBtn" class="glow-button" style="display: none; margin-top: 10px;">Collect All</button>
                </div>
            </div>
        </section>

        <!-- My Deck Section - IMPROVED -->
        <section id="my-deck" class="page">
            <div class="container">
                <h2>My Deck</h2>
                <p>Manage your powerful NFT card collection. Click a card to see details and actions!</p>
                <div class="deck-controls">
                    <label for="sortDeck">Sort by:</label>
                    <select id="sortDeck">
                        <option value="none">Default</option>
                        <option value="rarity">Rarity</option>
                        <option value="attack">Attack</option>
                        <option value="health">Health</option>
                        <option value="level">Level</option>
                    </select>
                </div>
                <div id="myDeckGridContainer"></div>
                <div id="cardDetailPopup" class="card-detail-popup" style="display: none;"></div>
            </div>
        </section>

        <!-- Leaderboard Section - IMPROVED -->
        <section id="leaderboard" class="page">
            <div class="container">
                <h2>Leaderboard</h2>
                <p>See the top players in SolBattles and their earnings! Rise through the ranks to claim glory.</p>
                <div class="leaderboard-table-container section-animate-in">
                    <table id="leaderboardTable">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Username</th>
                                <th>Wins</th>
                                <th>$SLUG Earned</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Leaderboard rows will be inserted here by JS -->
                        </tbody>
                    </table>
                </div>
                <p class="weekly-update-note text-animate-in">Leaderboard updates weekly. Climb the ranks!</p>
            </div>
        </section>

        <!-- Token Section - IMPROVED -->
        <section id="token" class="page">
            <div class="container">
                <h2>$SLUG Token</h2>
                <div class="token-info section-animate-in">
                    <h3>The Lifeblood of SolBattles</h3>
                    <p class="text-animate-in">$SLUG is the native utility token of the SolBattles ecosystem. It's designed to power every interaction within the game, creating a vibrant and sustainable economy.</p>
                    
                    <h4>Key Utilities:</h4>
                    <ul>
                        <li class="text-animate-in"><strong>Staking & Rewards:</strong> Stake $SLUG to earn passive income and participate in governance. <span class="coming-soon-badge">Coming Soon</span></li>
                        <li class="text-animate-in"><strong>Card Acquisition:</strong> Purchase new card packs and unique NFTs from the Shop.</li>
                        <li class="text-animate-in"><strong>Battle Entry Fees:</strong> Stake $SLUG to enter high-stakes battles with greater rewards.</li>
                        <li class="text-animate-in"><strong>Upgrades & Fusion:</strong> Use $SLUG to level up your cards and unlock powerful fusions. <span class="coming-soon-badge">Coming Soon</span></li>
                        <li class="text-animate-in"><strong>Marketplace Transactions:</strong> Trade NFTs with other players on the integrated marketplace. <span class="coming-soon-badge">Coming Soon</span></li>
                    </ul>

                    <h4>Tokenomics (Simplified):</h4>
                    <p class="text-animate-in">Total Supply: 1,000,000,000 $SLUG</p>
                    <p class="text-animate-in">Distribution:</p>
                    <ul>
                        <li class="text-animate-in">Gameplay Rewards: 60%</li>
                        <li class="text-animate-in">Staking Pool: 15%</li>
                        <li class="text-animate-in">Development Fund: 10%</li>
                        <li class="text-animate-in">Marketing & Partnerships: 10%</li>
                        <li class="text-animate-in">Team & Advisors: 5%</li>
                    </ul>
                </div>
                <div class="token-actions section-animate-in">
                    <button class="glow-button">Buy $SLUG on DEX</button>
                    <button class="glow-button inverted-button">View Contract on Solana Explorer</button>
                </div>
            </div>
        </section>

        <!-- Docs Section - IMPROVED -->
        <section id="docs" class="page">
            <div class="container">
                <h2>Documentation</h2>
                <div class="docs-section section-animate-in">
                    <p class="text-animate-in">Welcome to the SolBattles Documentation! Here you'll find everything you need to know about the game, from basic rules to advanced strategies, tokenomics, and blockchain integration.</p>
                    <p class="text-animate-in">We are constantly updating our documentation. If you have any questions, please join our community channels!</p>
                    <button class="glow-button primary-button text-animate-in">Read Full Whitepaper</button>
                    <button class="glow-button inverted-button text-animate-in" style="margin-left: 15px;">Join Discord Community</button>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 SolBattles. All rights reserved.</p>
        </div>
    </footer>

    <div id="universalPopup" class="universal-popup" style="display: none;">
        <div class="universal-popup-content">
            <span class="close-universal-popup">&times;</span>
            <p id="universalMessage"></p>
        </div>
    </div>
    <div id="confirmationPopup" class="universal-popup" style="display: none;">
        <div class="universal-popup-content">
            <span class="close-universal-popup">&times;</span>
            <p id="confirmationMessage"></p>
            <div style="display: flex; justify-content: center; gap: 15px;">
                <button id="confirmYesBtn" class="glow-button">Yes</button>
                <button id="confirmNoBtn" class="glow-button inverted-button">No</button>
            </div>
        </div>
    </div>


    <script>
        // --- Global State & Data ---
        let currentSLUG = 1000, ownedCards = [], selectedBattleCards = [], isWalletConnected = false;
        let playerHealth, opponentHealth; // Track health during battle
        let battleInterval; // To manage the battle loop
        let currentRoundPlayerCard, currentRoundOpponentCard; // Track current cards in battle
        let opponentDeckInBattle = []; // To store opponent's chosen cards for battle display

        const MOCK_WALLET_ADDRESS = "0xS0L...ddr3ss";
        const PLACEHOLDER_CARD_IMAGES = ['https://via.placeholder.com/180x250/FF5733/FFFFFF?text=CHAR_01', 'https://via.placeholder.com/180x250/00BFFF/FFFFFF?text=CHAR_02', 'https://via.placeholder.com/180x250/8A2BE2/FFFFFF?text=CHAR_03', 'https://via.placeholder.com/180x250/3CE6BC/FFFFFF?text=CHAR_04', 'https://via.placeholder.com/180x250/E94560/FFFFFF?text=CHAR_05'];
        const CARD_BACK_IMAGE = 'https://sdmntprwestus2.oaiusercontent.com/files/00000000-a838-61f8-88af-6dec43f37aaa/raw?se=2025-06-22T10%3A59%3A28Z&sp=r&sv=2024-08-04&sr=b&scid=3b398986-1433-50df-a3ed-e0360024a586&skoid=04233560-0ad7-493e-8bf0-1347c317d021&sktid=a48cca56-e6da-484e-a814-9c849652bcb3&skt=2025-06-21T17%3A38%3A49Z&ske=2025-06-22T17%3A38%3A49Z&sks=b&skv=2024-08-04&sig=ZWbCGbCxLfLI0s%2BKwRXHg6Oxp%2Bb%2BlFXgGiykKoOg/Ew%3D';
        const CHARACTER_NAMES = ["Shadowblade", "Mystic Monk", "Ironclad", "Solar Sentinel", "Void Weaver", "Flame Caller", "Aqua Guardian", "Terra Titan", "Cyber Dragon", "Cosmic Phoenix", "Grim Reaper", "Divine Healer"];
        const RARITIES = ["Common", "Rare", "Epic", "Legendary"];
        const RARITY_WEIGHTS = { "Common": 0.6, "Rare": 0.25, "Epic": 0.1, "Legendary": 0.05 };
        const shopInventory = [
            { id: 'pack001', name: 'Mystic Pack', price: 200, type: 'pack', description: 'Contains 3 random cards.', count: 3, rarityBoost: { 'Rare': 0.1 } },
            { id: 'pack002', name: 'Elite Pack', price: 500, type: 'pack', description: 'Contains 5 random cards, higher chance for rare.', count: 5, rarityBoost: { 'Rare': 0.2, 'Epic': 0.05 } },
            { id: 'pack003', name: 'Legendary Scroll', price: 1000, type: 'pack', description: 'Contains 1 guaranteed Legendary card!', count: 1, guaranteedRarity: 'Legendary' },
            { id: 'pack004', name: 'Elemental Cache', price: 350, type: 'pack', description: 'Contains 4 cards with a focus on elemental types.', count: 4, rarityBoost: { 'Rare': 0.15 } },
            { id: 'pack005', name: 'Ancestral Relic', price: 750, type: 'pack', description: 'Contains 2 powerful cards, very high chance for Epic.', count: 2, rarityBoost: { 'Epic': 0.2, 'Legendary': 0.02 } }
        ];
        let leaderboardData = [
            { rank: 1, username: 'CryptoKing', wins: 150, earnings: 75250 },
            { rank: 2, username: 'NFTChampion', wins: 130, earnings: 62100 },
            { rank: 3, username: 'SolSlayer', wins: 110, earnings: 55300 },
            { rank: 4, username: 'CardMaster', wins: 95, earnings: 48900 },
            { rank: 5, username: 'PixelWarrior', wins: 80, earnings: 32000 }
        ];

        // GSAP Plugin Registration
        gsap.registerPlugin(ScrollTrigger);

        // --- Core Functions ---
        function initializeOwnedCards() {
            ownedCards = [
                { id: 'player001', name: 'Basic Brawler', description: 'A solid fighter to start your journey.', imageUrl: PLACEHOLDER_CARD_IMAGES[0], attack: 10, defense: 8, health: 30, level: 1, rarity: 'Common', lore: '' },
                { id: 'player002', name: 'Nimble Rogue', description: 'Quick and agile, hard to hit.', imageUrl: PLACEHOLDER_CARD_IMAGES[1], attack: 12, defense: 6, health: 25, level: 1, rarity: 'Common', lore: '' },
                { id: 'player003', name: 'Stone Golem', description: 'Slow but incredibly tough.', imageUrl: PLACEHOLDER_CARD_IMAGES[2], attack: 7, defense: 15, health: 40, level: 1, rarity: 'Rare', lore: '' },
                { id: 'player004', name: 'Solar Sentinel', description: 'Guardian of the sun-drenched plains.', imageUrl: PLACEHOLDER_CARD_IMAGES[3], attack: 15, defense: 10, health: 35, level: 2, rarity: 'Rare', lore: '' },
                { id: 'player005', name: 'Void Weaver', description: 'Manipulates dark energies from beyond.', imageUrl: PLACEHOLDER_CARD_IMAGES[4], attack: 20, defense: 5, health: 30, level: 3, rarity: 'Epic', lore: '' }
            ];
        }

        function generateCardId() { return 'card_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9); }
        function getRandomElement(arr) { return arr[Math.floor(Math.random() * arr.length)]; }
        
        function getRandomRarity(rarityBoosts = {}) {
            let effectiveRarityWeights = { ...RARITY_WEIGHTS };
            for (const rarity in rarityBoosts) {
                effectiveRarityWeights[rarity] = (effectiveRarityWeights[rarity] || 0) + rarityBoosts[rarity];
            }

            // Normalize weights to ensure sum is 1
            const totalWeight = Object.values(effectiveRarityWeights).reduce((sum, weight) => sum + weight, 0);
            for (const rarity in effectiveRarityWeights) {
                effectiveRarityWeights[rarity] /= totalWeight;
            }

            const rand = Math.random();
            let cumulativeWeight = 0;
            for (const rarity of RARITIES) {
                cumulativeWeight += effectiveRarityWeights[rarity];
                if (rand < cumulativeWeight) {
                    return rarity;
                }
            }
            return "Common"; // Fallback
        }

        function generateRandomCard(options = {}) {
            const { guaranteedRarity = null, rarityBoosts = {} } = options;
            const rarity = guaranteedRarity || getRandomRarity(rarityBoosts);
            const name = getRandomElement(CHARACTER_NAMES) + ' ' + rarity.split('')[0];
            const imageUrl = getRandomElement(PLACEHOLDER_CARD_IMAGES);
            let attack, defense, health;

            switch (rarity) {
                case 'Common': attack = Math.floor(Math.random() * 5) + 8; defense = Math.floor(Math.random() * 4) + 6; health = Math.floor(Math.random() * 10) + 25; break;
                case 'Rare': attack = Math.floor(Math.random() * 7) + 12; defense = Math.floor(Math.random() * 5) + 8; health = Math.floor(Math.random() * 15) + 35; break;
                case 'Epic': attack = Math.floor(Math.random() * 10) + 18; defense = Math.floor(Math.random() * 6) + 10; health = Math.floor(Math.random() * 20) + 50; break;
                case 'Legendary': attack = Math.floor(Math.random() * 15) + 25; defense = Math.floor(Math.random() * 8) + 12; health = Math.floor(Math.random() * 30) + 70; break;
            }

            return {
                id: generateCardId(),
                name: name,
                description: `A powerful ${rarity.toLowerCase()} card from the SolBattles realm.`,
                imageUrl: imageUrl,
                attack: attack,
                defense: defense,
                health: health,
                level: 1,
                rarity: rarity,
                lore: ''
            };
        }

        function createCardHTML(card, showBuyButton = false, isSelectableForBattle = false) {
            const rarityClass = card.rarity ? `rarity ${card.rarity.toLowerCase()}` : '';
            const buyButton = showBuyButton ? `<button class="glow-button buy-button" data-card-id="${card.id}">Buy Pack</button>` : '';
            const selectableClass = isSelectableForBattle ? 'selectable-card' : '';
            return `
                <div class="card ${selectableClass}" data-card-id="${card.id}" data-card-name="${card.name}">
                    <img src="${card.imageUrl}" alt="${card.name}">
                    <h4>${card.name}</h4>
                    <p>${card.description}</p>
                    <div class="card-stats">
                        <span class="card-stat">ATK: ${card.attack}</span>
                        <span class="card-stat">DEF: ${card.defense}</span>
                        <span class="card-stat">HP: ${card.health}</span>
                        <span class="card-stat">LV: ${card.level}</span>
                    </div>
                    <p class="${rarityClass}">${card.rarity}</p>
                    ${buyButton}
                </div>
            `;
        }

        function showUniversalPopup(message) {
            const universalPopup = document.getElementById('universalPopup');
            // Ensure universalPopup and its children exist before trying to query
            if (!universalPopup) {
                console.error('Universal popup element not found!');
                return;
            }
            const popupContent = universalPopup.querySelector('.universal-popup-content');
            if (!popupContent) {
                console.error('Universal popup content element not found!');
                return;
            }
            const messageElement = popupContent.querySelector('#universalMessage');
            if (!messageElement) {
                console.error('Universal popup message element not found!');
                return;
            }

            messageElement.textContent = message;
            universalPopup.style.display = 'flex';
            const closeButton = universalPopup.querySelector('.close-universal-popup');
            if (closeButton) {
                closeButton.onclick = () => { universalPopup.style.display = 'none'; };
            }
        }

        function showConfirmationPopup(message, onConfirm) {
            const confirmationPopup = document.getElementById('confirmationPopup');
            // Ensure confirmationPopup and its children exist before trying to query
            if (!confirmationPopup) {
                console.error('Confirmation popup element not found!');
                return;
            }
            const confirmationMessageElement = confirmationPopup.querySelector('#confirmationMessage');
            if (!confirmationMessageElement) {
                console.error('Confirmation message element not found!');
                return;
            }

            confirmationMessageElement.textContent = message;
            confirmationPopup.style.display = 'flex';

            const confirmYesBtn = document.getElementById('confirmYesBtn');
            const confirmNoBtn = document.getElementById('confirmNoBtn');
            const closeButton = confirmationPopup.querySelector('.close-universal-popup');

            const cleanup = () => {
                confirmYesBtn.onclick = null;
                confirmNoBtn.onclick = null;
                closeButton.onclick = null;
                confirmationPopup.style.display = 'none';
            };

            confirmYesBtn.onclick = () => {
                onConfirm(true);
                cleanup();
            };
            confirmNoBtn.onclick = () => {
                onConfirm(false);
                cleanup();
            };
            closeButton.onclick = () => {
                onConfirm(false); // Treat closing as cancellation
                cleanup();
            };
        }


        // --- Render Functions for Each Page ---
        function renderShop() {
            const shopGridContainer = document.getElementById('shopGridContainer');
            shopGridContainer.innerHTML = ''; // Clear previous content

            shopInventory.forEach(item => {
                const packCard = {
                    id: item.id,
                    name: item.name,
                    description: `${item.description} Cost: ${item.price} $SLUG`,
                    imageUrl: 'https://via.placeholder.com/180x250/4DCFFD/FFFFFF?text=CARD+PACK', // Generic pack image
                    attack: 'N/A', defense: 'N/A', health: 'N/A', level: 'N/A', rarity: 'Pack'
                };
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = createCardHTML(packCard, true);
                shopGridContainer.appendChild(tempDiv.firstElementChild);
            });
            
            // Re-attach event listeners for dynamically added buy buttons
            document.querySelectorAll('.buy-button').forEach(button => {
                button.onclick = (e) => handleBuyCard(e.target.dataset.cardId);
            });

            // Ensure shop grid is visible and animation is hidden
            shopGridContainer.style.display = 'grid';
            document.getElementById('packOpeningAnimation').style.display = 'none';
        }

        function handleBuyCard(itemId) {
            if (!isWalletConnected) {
                showUniversalPopup('Please connect your wallet first!');
                return;
            }
            const item = shopInventory.find(i => i.id === itemId);
            if (!item) return;

            showConfirmationPopup(`Are you sure you want to buy a ${item.name} for ${item.price} $SLUG?`, (confirmed) => {
                if (!confirmed) return;

                if (currentSLUG >= item.price) {
                    currentSLUG -= item.price;
                    updateSLUGDisplay();
                    showUniversalPopup(`You bought a ${item.name}!`);

                    document.getElementById('shopGridContainer').style.display = 'none';
                    const packAnimation = document.getElementById('packOpeningAnimation');
                    packAnimation.style.display = 'flex';
                    const revealedCardsGrid = document.getElementById('revealedCardsGrid');
                    revealedCardsGrid.innerHTML = '';
                    revealedCardsGrid.style.display = 'none';
                    document.getElementById('revealCardBtn').style.display = 'block';
                    document.getElementById('collectCardsBtn').style.display = 'none';
                    packAnimation.querySelector('h3').textContent = 'Opening Pack...';
                    packAnimation.querySelector('.reveal-message').textContent = 'Click to reveal your cards!';
                    packAnimation.querySelector('.pack-image').src = 'https://via.placeholder.com/200x200/533483/e0e0e0?text=PACK';
                    // Reset GSAP animation for pack image if it was altered
                    gsap.to(packAnimation.querySelector('.pack-image'), { y: 0, rotation: 0, duration: 0.5, ease: "power1.out" });


                    let cardsToReveal = [];
                    if (item.type === 'pack') {
                        for (let i = 0; i < item.count; i++) {
                            let newCard;
                            if (item.guaranteedRarity) {
                                newCard = generateRandomCard({ guaranteedRarity: item.guaranteedRarity });
                            } else {
                                newCard = generateRandomCard({ rarityBoosts: item.rarityBoost });
                            }
                            cardsToReveal.push(newCard);
                        }
                    }
                    
                    let revealedCount = 0;
                    const revealNextCard = () => {
                        if (revealedCount < cardsToReveal.length) {
                            const card = cardsToReveal[revealedCount];
                            ownedCards.push(card); // Add card to ownedCards array
                            const cardFlipContainer = document.createElement('div');
                            cardFlipContainer.className = 'card-flip-container';
                            cardFlipContainer.innerHTML = `
                                <div class="card-front">
                                    <img src="${CARD_BACK_IMAGE}" alt="Card Back">
                                </div>
                                <div class="card-back">
                                    <img src="${card.imageUrl}" alt="${card.name}">
                                    <h4>${card.name}</h4>
                                    <p>${card.description}</p>
                                    <div class="card-stats">
                                        <span class="card-stat">ATK: ${card.attack}</span>
                                        <span class="card-stat">DEF: ${card.defense}</span>
                                        <span class="card-stat">HP: ${card.health}</span>
                                        <span class="card-stat">LV: ${card.level}</span>
                                    </div>
                                    <p class="rarity ${card.rarity.toLowerCase()}">${card.rarity}</p>
                                </div>
                            `;
                            revealedCardsGrid.appendChild(cardFlipContainer);
                            revealedCardsGrid.style.display = 'grid';

                            gsap.to(cardFlipContainer, { rotationY: 180, duration: 0.8, ease: "back.out(1.7)" });

                            revealedCount++;
                            packAnimation.querySelector('.reveal-message').textContent = `Revealed ${revealedCount} of ${cardsToReveal.length} cards.`;
                            if (revealedCount === cardsToReveal.length) {
                                document.getElementById('revealCardBtn').style.display = 'none';
                                document.getElementById('collectCardsBtn').style.display = 'block';
                                packAnimation.querySelector('h3').textContent = 'Pack Opened!';
                                packAnimation.querySelector('.reveal-message').textContent = 'All cards revealed!';
                                gsap.to(packAnimation.querySelector('.pack-image'), { rotation: 360, duration: 1, ease: "power1.out", onComplete: () => {
                                    packAnimation.querySelector('.pack-image').src = 'https://via.placeholder.com/200x200/533483/e0e0e0?text=PACK+OPENED';
                                }});
                            }
                        }
                    };

                    document.getElementById('revealCardBtn').onclick = revealNextCard;
                    document.getElementById('collectCardsBtn').onclick = () => {
                        packAnimation.style.display = 'none';
                        document.getElementById('shopGridContainer').style.display = 'grid';
                        renderMyDeck(document.getElementById('sortDeck').value || 'none'); // Re-render deck after collecting
                        showUniversalPopup('Cards collected and added to your deck!');
                    };

                } else {
                    showUniversalPopup(`Not enough $SLUG! You need ${item.price} $SLUG.`);
                }
            });
        }


        function renderMyDeck(sortBy = 'none') {
            const myDeckGridContainer = document.getElementById('myDeckGridContainer');
            myDeckGridContainer.innerHTML = ''; // Clear existing cards

            const myDeckGrid = document.createElement('div');
            myDeckGrid.className = 'my-deck-grid';

            let cardsToDisplay = [...ownedCards];

            if (sortBy === 'rarity') {
                const rarityOrder = { 'Legendary': 4, 'Epic': 3, 'Rare': 2, 'Common': 1 };
                cardsToDisplay.sort((a, b) => rarityOrder[b.rarity] - rarityOrder[a.rarity]);
            } else if (sortBy === 'attack') {
                cardsToDisplay.sort((a, b) => b.attack - a.attack);
            } else if (sortBy === 'health') {
                cardsToDisplay.sort((a, b) => b.health - a.health);
            } else if (sortBy === 'level') {
                cardsToDisplay.sort((a, b) => b.level - a.level);
            }


            if (cardsToDisplay.length === 0) {
                myDeckGrid.innerHTML = '<p style="text-align: center; margin-top: 50px; grid-column: 1 / -1;">Your deck is empty! Buy some packs from the <a href="#shop" class="nav-link" data-page="shop">Shop</a>.</p>';
            } else {
                cardsToDisplay.forEach(card => {
                    myDeckGrid.innerHTML += createCardHTML(card);
                });
            }

            // Append the new grid to its container
            myDeckGridContainer.appendChild(myDeckGrid);

            // Set the selected value for the sort dropdown
            const sortDeckSelect = document.getElementById('sortDeck');
            if (sortDeckSelect) {
                sortDeckSelect.value = sortBy;
                sortDeckSelect.onchange = (e) => {
                    renderMyDeck(e.target.value);
                };
            }

            // Re-attach click listeners for each card in the deck
            myDeckGrid.querySelectorAll('.card').forEach(cardElement => {
                cardElement.addEventListener('click', () => {
                    const cardId = cardElement.dataset.cardId;
                    const card = ownedCards.find(c => c.id === cardId);
                    if (card) {
                        showCardDetail(card);
                    }
                });
            });
        }

        async function showCardDetail(card) {
            const cardDetailPopup = document.getElementById('cardDetailPopup');
            cardDetailPopup.innerHTML = `
                <div class="card-detail-content">
                    <span class="close-popup">&times;</span>
                    <img src="${card.imageUrl}" alt="${card.name}">
                    <h3>${card.name}</h3>
                    <p>${card.description}</p>
                    <p><strong>Rarity:</strong> <span class="rarity ${card.rarity.toLowerCase()}">${card.rarity}</span></p>
                    <p><strong>Level:</strong> ${card.level}</p>
                    <div class="card-stats">
                        <span class="card-stat">ATK: ${card.attack}</span>
                        <span class="card-stat">DEF: ${card.defense}</span>
                        <span class="card-stat">HP: ${card.health}</span>
                    </div>
                    <div class="card-actions">
                        <button class="glow-button">Stake Card</button>
                        <button id="levelUpCardBtn" class="glow-button">Level Up (${card.level * 50} $SLUG)</button>
                        <button id="sellCardBtn" class="glow-button inverted-button">Sell Card</button>
                        <button id="generateLoreBtn" class="glow-button" style="margin-top: 10px;">âœ¨ Generate Lore</button>
                    </div>
                    <div id="cardLoreOutput" class="card-lore" style="display:none;"></div>
                </div>
            `;
            cardDetailPopup.style.display = 'flex';
            cardDetailPopup.querySelector('.close-popup').onclick = () => {
                cardDetailPopup.style.display = 'none';
            };

            const cardLoreOutput = document.getElementById('cardLoreOutput');
            if (card.lore) {
                cardLoreOutput.textContent = card.lore;
                cardLoreOutput.style.display = 'block';
            }

            // --- Sell Card Functionality ---
            document.getElementById('sellCardBtn').onclick = () => {
                if (!isWalletConnected) {
                    showUniversalPopup('Please connect your wallet to sell cards!');
                    return;
                }
                const sellPrice = card.level * 10 + (card.rarity === 'Common' ? 50 : card.rarity === 'Rare' ? 100 : card.rarity === 'Epic' ? 250 : 500);
                showConfirmationPopup(`Are you sure you want to sell ${card.name} for ${sellPrice} $SLUG?`, (confirmed) => {
                    if (confirmed) {
                        // Find the index of the card to remove
                        const cardIndex = ownedCards.findIndex(c => c.id === card.id);
                        if (cardIndex > -1) {
                            ownedCards.splice(cardIndex, 1); // Remove the card
                            currentSLUG += sellPrice;
                            updateSLUGDisplay();
                            cardDetailPopup.style.display = 'none'; // Close popup
                            renderMyDeck(document.getElementById('sortDeck').value); // Re-render deck
                            showUniversalPopup(`${card.name} sold for ${sellPrice} $SLUG!`);
                        }
                    }
                });
            };

            // --- Level Up Card Functionality ---
            document.getElementById('levelUpCardBtn').onclick = () => {
                if (!isWalletConnected) {
                    showUniversalPopup('Please connect your wallet to level up cards!');
                    return;
                }
                const upgradeCost = card.level * 50;
                if (currentSLUG >= upgradeCost) {
                    showConfirmationPopup(`Level up ${card.name} for ${upgradeCost} $SLUG?`, (confirmed) => {
                        if (confirmed) {
                            currentSLUG -= upgradeCost;
                            card.level++;
                            // Increase stats by a percentage or fixed amount
                            card.attack = Math.round(card.attack * 1.07); // 7% increase
                            card.defense = Math.round(card.defense * 1.07);
                            card.health = Math.round(card.health * 1.10); // Health increases a bit more
                            updateSLUGDisplay();
                            // Re-render this specific card's detail and the main deck
                            showCardDetail(card); // Re-open with updated stats
                            renderMyDeck(document.getElementById('sortDeck').value); // Update deck view
                            showUniversalPopup(`${card.name} leveled up to Level ${card.level}!`);
                        }
                    });
                } else {
                    showUniversalPopup(`Not enough $SLUG! You need ${upgradeCost} $SLUG to level up.`);
                }
            };


            const generateLoreBtn = document.getElementById('generateLoreBtn');
            generateLoreBtn.onclick = async () => {
                generateLoreBtn.textContent = 'Generating...';
                generateLoreBtn.disabled = true;
                cardLoreOutput.style.display = 'none';
                cardLoreOutput.textContent = '';

                try {
                    const prompt = `Generate a short, fantastical, and engaging lore description (around 60-80 words) for a SolBattles card with the following details:
                    Name: ${card.name}
                    Rarity: ${card.rarity}
                    Attack: ${card.attack}
                    Defense: ${card.defense}
                    Health: ${card.health}
                    Focus on its origin, abilities, or impact in the SolBattles world.`;

                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                    const payload = { contents: chatHistory };
                    const apiKey = "";
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const lore = result.candidates[0].content.parts[0].text;
                        card.lore = lore;
                        cardLoreOutput.textContent = lore;
                        cardLoreOutput.style.display = 'block';
                    } else {
                        cardLoreOutput.textContent = 'Failed to generate lore. Please try again.';
                        cardLoreOutput.style.display = 'block';
                    }
                } catch (error) {
                    console.error('Error generating lore:', error);
                    cardLoreOutput.textContent = 'An error occurred while contacting the AI. Please try again later.';
                    cardLoreOutput.style.display = 'block';
                } finally {
                    generateLoreBtn.textContent = 'âœ¨ Generate Lore';
                    generateLoreBtn.disabled = false;
                }
            };
        }


        function renderArenaCardSelection() {
            const arenaContent = document.querySelector('#arena .container');
            arenaContent.innerHTML = `
                <h2>Arena</h2>
                <div class="arena-setup section-animate-in" id="arenaSetup">
                    <h3>Prepare for Battle!</h3>
                    <p>Select 3 cards from your deck to enter the arena. The more powerful your deck, the higher the stakes!</p>
                    <div class="wallet-stake-input">
                        Stake Amount: <input type="number" id="stakeAmount" value="50" min="10" step="10"> $SLUG
                    </div>
                    <div id="selectedCardsDisplay" class="card-grid">
                        <p style="grid-column: 1 / -1; color: #ccc;">Select your 3 battle cards below.</p>
                    </div>
                    <div style="display: flex; justify-content: center; gap: 15px; margin-top: 20px; flex-wrap: wrap;">
                        <button id="findOpponentBtn" class="glow-button primary-button" disabled>Find Opponent</button>
                        <button id="getStrategyBtn" class="glow-button" disabled>âœ¨ Get Strategy Advice</button>
                    </div>
                    <div id="strategyAdvice" class="battle-log" style="display:none; margin-top: 20px; text-align: left;"></div>
                </div>
                <h3 style="margin-top: 50px;">Your Deck</h3>
                <div id="availableCardsGrid" class="card-selection-grid"></div>

                <div id="battleDisplay" class="battle-ui section-animate-in" style="display:none;">
                    <h3>BATTLE IN PROGRESS!</h3>
                    <div style="display: flex; justify-content: space-around; align-items: flex-start; width: 100%; flex-wrap: wrap; gap: 20px;">
                        <!-- Opponent Area -->
                        <div class="opponent-area">
                            <h4>Opponent's Side</h4>
                            <div class="current-card-display opponent-card" id="opponentCurrentCard">
                                <img src="${CARD_BACK_IMAGE}" alt="Opponent Card">
                            </div>
                            <div class="health-bar-container"><div class="health-bar opponent-hp" id="opponentHealthBar" style="width: 100%;"></div></div>
                            <div class="opponent-deck-display" id="opponentDeckDisplay">
                                <!-- Opponent card backs -->
                            </div>
                        </div>

                        <!-- VS Indicator -->
                        <div style="font-size: 3rem; font-weight: bold; color: var(--highlight-color); align-self: center;">VS</div>

                        <!-- Player Area -->
                        <div class="player-area">
                            <h4>Your Side</h4>
                            <div class="current-card-display player-card" id="playerCurrentCard">
                                <img src="${CARD_BACK_IMAGE}" alt="Your Card">
                            </div>
                            <div class="health-bar-container"><div class="health-bar" id="playerHealthBar" style="width: 100%;"></div></div>
                            <div class="player-deck-display" id="playerDeckDisplay">
                                <!-- Player active cards -->
                            </div>
                        </div>
                    </div>

                    <div class="battle-log" id="battleLog"></div>
                    <!-- "Next Round" button removed for automation -->
                </div>

                <div id="battleResults" class="battle-results-box section-animate-in" style="display:none;">
                    <h3>Battle Results</h3>
                    <p id="battleWinner"></p>
                    <p id="battleLoser"></p>
                    <button id="playAgainBtn" class="glow-button primary-button" style="margin-top: 20px;">Play Again</button>
                </div>
            `;

            const availableCardsGrid = document.getElementById('availableCardsGrid');
            if (ownedCards.length < 3) {
                availableCardsGrid.innerHTML = '<p style="text-align: center; grid-column: 1 / -1;">You need at least 3 cards to battle. Head to the <a href="#shop" class="nav-link" data-page="shop">Shop</a>!</p>';
                document.getElementById('findOpponentBtn').disabled = true;
                document.getElementById('getStrategyBtn').disabled = true;
            } else {
                ownedCards.forEach(card => {
                    const cardHtml = createCardHTML(card, false, true);
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = cardHtml;
                    const cardElement = tempDiv.firstElementChild;
                    availableCardsGrid.appendChild(cardElement);

                    cardElement.addEventListener('click', () => {
                        toggleCardSelection(card);
                    });
                });
            }
            document.getElementById('findOpponentBtn').onclick = startBattle;
            document.getElementById('playAgainBtn').onclick = () => {
                selectedBattleCards = [];
                renderArenaCardSelection();
                document.getElementById('battleResults').style.display = 'none';
            };
            // Removed nextRoundBtn listener as rounds are automated now

            const getStrategyBtn = document.getElementById('getStrategyBtn');
            getStrategyBtn.onclick = async () => {
                if (selectedBattleCards.length !== 3) {
                    showUniversalPopup('Please select exactly 3 cards for strategy advice.');
                    return;
                }

                getStrategyBtn.textContent = 'Thinking...';
                getStrategyBtn.disabled = true;
                const strategyAdviceOutput = document.getElementById('strategyAdvice');
                strategyAdviceOutput.style.display = 'none';
                strategyAdviceOutput.innerHTML = '';

                try {
                    const cardInfo = selectedBattleCards.map(card => `Name: ${card.name}, Rarity: ${card.rarity}, ATK: ${card.attack}, DEF: ${card.defense}, HP: ${card.health}`).join('\n');

                    const prompt = `Given the following SolBattles cards, provide a concise battle strategy (around 80-100 words) for a card game. Focus on synergy, strengths, weaknesses, and a general approach.
                    Your selected cards are:
                    ${cardInfo}

                    Formulate a strategy for a general opponent.`;

                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                    const payload = { contents: chatHistory };
                    const apiKey = "";
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const advice = result.candidates[0].content.parts[0].text;
                        strategyAdviceOutput.innerHTML = `<p><strong>AI Strategy Advice:</strong></p><p>${advice}</p>`;
                        strategyAdviceOutput.style.display = 'block';
                    } else {
                        strategyAdviceOutput.innerHTML = '<p>Failed to get strategy advice. Please try again.</p>';
                        strategyAdviceOutput.style.display = 'block';
                    }
                } catch (error) {
                    console.error('Error getting strategy advice:', error);
                    strategyAdviceOutput.innerHTML = '<p>An error occurred while contacting the AI. Please try again later.</p>';
                    strategyAdviceOutput.style.display = 'block';
                } finally {
                    getStrategyBtn.textContent = 'âœ¨ Generate Lore';
                    getStrategyBtn.disabled = false;
                }
            };
        }

        function toggleCardSelection(card) {
            const cardElement = document.querySelector(`.card[data-card-id="${card.id}"]`);
            const findOpponentBtn = document.getElementById('findOpponentBtn');
            const getStrategyBtn = document = document.getElementById('getStrategyBtn');

            if (selectedBattleCards.some(c => c.id === card.id)) {
                selectedBattleCards = selectedBattleCards.filter(c => c.id !== card.id);
                cardElement.classList.remove('selected');
            } else {
                if (selectedBattleCards.length < 3) {
                    selectedBattleCards.push(card);
                    cardElement.classList.add('selected');
                } else {
                    showUniversalPopup('You can only select up to 3 cards for battle!');
                }
            }
            updateSelectedCardsDisplay();
            const isThreeCardsSelected = selectedBattleCards.length === 3;
            findOpponentBtn.disabled = !isThreeCardsSelected;
            getStrategyBtn.disabled = !isThreeCardsSelected;
        }

        function updateSelectedCardsDisplay() {
            const selectedCardsDisplay = document.getElementById('selectedCardsDisplay');
            selectedCardsDisplay.innerHTML = '';
            if (selectedBattleCards.length === 0) {
                selectedCardsDisplay.innerHTML = '<p style="grid-column: 1 / -1; color: #ccc;">Select your 3 battle cards below.</p>';
            } else {
                selectedBattleCards.forEach(card => {
                    selectedCardsDisplay.innerHTML += createCardHTML(card);
                });
            }
        }

        function startBattle() {
            if (!isWalletConnected) {
                showUniversalPopup('Please connect your wallet to battle!');
                return;
            }
            if (selectedBattleCards.length !== 3) {
                showUniversalPopup('Please select exactly 3 cards to start a battle.');
                return;
            }
            const stakeAmount = parseInt(document.getElementById('stakeAmount').value);
            if (isNaN(stakeAmount) || stakeAmount <= 0 || currentSLUG < stakeAmount) {
                showUniversalPopup('Invalid stake amount or insufficient $SLUG balance.');
                return;
            }
            currentSLUG -= stakeAmount;
            updateSLUGDisplay();

            document.getElementById('arenaSetup').style.display = 'none';
            document.getElementById('availableCardsGrid').style.display = 'none';
            document.getElementById('battleDisplay').style.display = 'flex';
            document.getElementById('battleResults').style.display = 'none';

            const battleLog = document.getElementById('battleLog');
            battleLog.innerHTML = '';
            addLog('Battle starting!', 'system-message');

            playerHealth = 100;
            opponentHealth = 100;
            updateHealthBars();

            opponentDeckInBattle = [generateRandomCard(), generateRandomCard(), generateRandomCard()];
            addLog(`Opponent has entered the arena with: ${opponentDeckInBattle.map(c => c.name).join(', ')}`, 'system-message');
            renderOpponentDeckDisplay();

            currentRoundPlayerCard = getRandomElement(selectedBattleCards);
            currentRoundOpponentCard = getRandomElement(opponentDeckInBattle);
            updateCurrentCardsDisplay();

            addLog(`Your ${currentRoundPlayerCard.name} faces Opponent's ${currentRoundOpponentCard.name}!`, 'system-message');

            // Start automated rounds
            battleInterval = setInterval(advanceBattleRound, 2000); // Automate rounds every 2 seconds
        }

        function advanceBattleRound() {
            const battleLog = document.getElementById('battleLog');
            
            if (playerHealth <= 0 || opponentHealth <= 0) {
                clearInterval(battleInterval);
                setTimeout(() => {
                    const winnerMessage = document.getElementById('battleWinner');
                    const loserMessage = document.getElementById('battleLoser');
                    const stakeAmount = parseInt(document.getElementById('stakeAmount').value);
                    if (playerHealth > opponentHealth) {
                        addLog('You won the battle!', 'winner-message');
                        winnerMessage.textContent = 'YOU WIN!';
                        loserMessage.textContent = `You earned ${stakeAmount * 2} $SLUG!`;
                        currentSLUG += stakeAmount * 2;
                    } else {
                        addLog('You lost the battle!', 'loser-message');
                        winnerMessage.textContent = 'OPPONENT WINS!';
                        loserMessage.textContent = `You lost ${stakeAmount} $SLUG.`;
                    }
                    updateSLUGDisplay();
                    document.getElementById('battleDisplay').style.display = 'none';
                    document.getElementById('battleResults').style.display = 'block';
                }, 500);
                return;
            }

            // Simplified round logic for demonstration
            let roundMessage = `--- Battle Round ---`;
            addLog(roundMessage, 'system-message');

            // Player attacks opponent
            let playerDamage = Math.max(1, currentRoundPlayerCard.attack - currentRoundOpponentCard.defense / 2);
            opponentHealth -= playerDamage;
            addLog(`Your ${currentRoundPlayerCard.name} dealt ${playerDamage.toFixed(0)} damage to Opponent's ${currentRoundOpponentCard.name}.`);
            updateHealthBars();

            if (opponentHealth <= 0) {
                addLog(`Opponent's ${currentRoundOpponentCard.name} has been defeated!`);
                clearInterval(battleInterval); // Stop here if opponent is defeated
                advanceBattleRound(); // Call again to trigger win condition check
                return;
            }

            // Opponent attacks player
            let opponentDamage = Math.max(1, currentRoundOpponentCard.attack - currentRoundPlayerCard.defense / 2);
            playerHealth -= opponentDamage;
            addLog(`Opponent's ${currentRoundOpponentCard.name} dealt ${opponentDamage.toFixed(0)} damage to your ${currentRoundPlayerCard.name}.`);
            updateHealthBars();

            if (playerHealth <= 0) {
                addLog(`Your ${currentRoundPlayerCard.name} has been defeated!`);
                clearInterval(battleInterval); // Stop here if player is defeated
                advanceBattleRound(); // Call again to trigger lose condition check
                return;
            }

            // If battle continues, pick new random cards for next display
            currentRoundPlayerCard = getRandomElement(selectedBattleCards);
            currentRoundOpponentCard = getRandomElement(opponentDeckInBattle);
            updateCurrentCardsDisplay();
            addLog(`Next: Your ${currentRoundPlayerCard.name} vs Opponent's ${currentRoundOpponentCard.name}.`);
        }

        function updateHealthBars() {
            const playerHealthBar = document.getElementById('playerHealthBar');
            const opponentHealthBar = document.getElementById('opponentHealthBar');

            playerHealthBar.style.width = `${Math.max(0, playerHealth)}%`;
            opponentHealthBar.style.width = `${Math.max(0, opponentHealth)}%`;

            if (playerHealth < 30) playerHealthBar.classList.add('low-hp'); else playerHealthBar.classList.remove('low-hp');
            if (opponentHealth < 30) opponentHealthBar.classList.add('low-hp'); else opponentHealthBar.classList.remove('low-hp');
        }

        function updateCurrentCardsDisplay() {
            document.getElementById('playerCurrentCard').innerHTML = `<img src="${currentRoundPlayerCard.imageUrl}" alt="${currentRoundPlayerCard.name}">`;
            document.getElementById('opponentCurrentCard').innerHTML = `<img src="${currentRoundOpponentCard.imageUrl}" alt="${currentRoundOpponentCard.name}">`;
        }

        function renderOpponentDeckDisplay() {
            const opponentDeckDisplay = document.getElementById('opponentDeckDisplay');
            opponentDeckDisplay.innerHTML = '';
            opponentDeckInBattle.forEach(card => {
                const cardBackDiv = document.createElement('div');
                cardBackDiv.className = 'opponent-deck-card';
                cardBackDiv.innerHTML = `<img src="${CARD_BACK_IMAGE}" alt="Card Back" style="width: 100%; height: 100%; object-fit: cover; border-radius: 5px;">`;
                opponentDeckDisplay.appendChild(cardBackDiv);
            });
        }


        function addLog(message, type = '') {
            const battleLog = document.getElementById('battleLog');
            const p = document.createElement('p');
            p.textContent = message;
            if (type) p.classList.add(type);
            battleLog.appendChild(p);
            battleLog.scrollTop = battleLog.scrollHeight;
        }


        function renderLeaderboard() {
            const leaderboardContent = document.querySelector('#leaderboard .container');
            leaderboardContent.innerHTML = `
                <h2>Leaderboard</h2>
                <p>See the top players in SolBattles and their earnings! Rise through the ranks to claim glory.</p>
                <div class="leaderboard-table-container section-animate-in">
                    <table id="leaderboardTable">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Username</th>
                                <th>Wins</th>
                                <th>$SLUG Earned</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Leaderboard rows will be inserted here by JS -->
                        </tbody>
                    </table>
                </div>
                <p class="weekly-update-note text-animate-in">Leaderboard updates weekly. Climb the ranks!</p>
            `;

            const tbody = document.querySelector('#leaderboardTable tbody');
            tbody.innerHTML = '';
            
            leaderboardData.sort((a, b) => b.wins - a.wins);

            leaderboardData.forEach((player, index) => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${player.rank}</td>
                    <td>${player.username}</td>
                    <td>${player.wins}</td>
                    <td>${player.earnings.toLocaleString()}</td>
                `;
            });
        }


        function renderTokenPage() {
            const tokenContent = document.querySelector('#token .container');
            tokenContent.innerHTML = `
                <h2>$SLUG Token</h2>
                <div class="token-info section-animate-in">
                    <h3>The Lifeblood of SolBattles</h3>
                    <p class="text-animate-in">$SLUG is the native utility token of the SolBattles ecosystem. It's designed to power every interaction within the game, creating a vibrant and sustainable economy.</p>
                    
                    <h4>Key Utilities:</h4>
                    <ul>
                        <li class="text-animate-in"><strong>Staking & Rewards:</strong> Stake $SLUG to earn passive income and participate in governance. <span class="coming-soon-badge">Coming Soon</span></li>
                        <li class="text-animate-in"><strong>Card Acquisition:</strong> Purchase new card packs and unique NFTs from the Shop.</li>
                        <li class="text-animate-in"><strong>Battle Entry Fees:</strong> Stake $SLUG to enter high-stakes battles with greater rewards.</li>
                        <li class="text-animate-in"><strong>Upgrades & Fusion:</strong> Use $SLUG to level up your cards and unlock powerful fusions. <span class="coming-soon-badge">Coming Soon</span></li>
                        <li class="text-animate-in"><strong>Marketplace Transactions:</strong> Trade NFTs with other players on the integrated marketplace. <span class="coming-soon-badge">Coming Soon</span></li>
                    </ul>

                    <h4>Tokenomics (Simplified):</h4>
                    <p class="text-animate-in">Total Supply: 1,000,000,000 $SLUG</p>
                    <p class="text-animate-in">Distribution:</p>
                    <ul>
                        <li class="text-animate-in">Gameplay Rewards: 60%</li>
                        <li class="text-animate-in">Staking Pool: 15%</li>
                        <li class="text-animate-in">Development Fund: 10%</li>
                        <li class="text-animate-in">Marketing & Partnerships: 10%</li>
                        <li class="text-animate-in">Team & Advisors: 5%</li>
                    </ul>
                </div>
                <div class="token-actions section-animate-in">
                    <button class="glow-button">Buy $SLUG on DEX</button>
                    <button class="glow-button inverted-button">View Contract on Solana Explorer</button>
                </div>
            `;
        }

        function renderDocsPage() {
            const docsContent = document.querySelector('#docs .container');
            docsContent.innerHTML = `
                <h2>Documentation</h2>
                <div class="docs-section section-animate-in">
                    <p class="text-animate-in">Welcome to the SolBattles Documentation! Here you'll find everything you need to know about the game, from basic rules to advanced strategies, tokenomics, and blockchain integration.</p>
                    <p class="text-animate-in">We are constantly updating our documentation. If you have any questions, please join our community channels!</p>
                    <button class="glow-button primary-button text-animate-in">Read Full Whitepaper</button>
                    <button class="glow-button inverted-button text-animate-in" style="margin-left: 15px;">Join Discord Community</button>
                </div>
            `;
        }

        // --- Wallet Connection & Utility ---
        document.getElementById('connectWalletBtn').onclick = () => {
            const connectBtn = document.getElementById('connectWalletBtn');
            const walletStatusDiv = document.getElementById('walletStatus');
            if (!isWalletConnected) {
                connectBtn.textContent = '...'; connectBtn.disabled = true;
                setTimeout(() => {
                    isWalletConnected = true; 
                    connectBtn.style.display = 'none';
                    walletStatusDiv.style.display = 'flex';
                    walletStatusDiv.classList.add('connected');
                    document.getElementById('walletAddress').textContent = MOCK_WALLET_ADDRESS.substring(0, 6) + '...' + MOCK_WALLET_ADDRESS.substring(MOCK_WALLET_ADDRESS.length - 4);
                    updateSLUGDisplay(); 
                    showUniversalPopup('Wallet connected!');
                }, 1500);
            }
        };

        function updateSLUGDisplay() {
            const slugBalanceDisplay = document.getElementById('slugBalanceDisplay');
            if (slugBalanceDisplay) slugBalanceDisplay.textContent = `${currentSLUG} $SLUG`;
        }


        // --- Page Navigation Logic ---
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetPageId = e.target.dataset.page;

                // Stop battle if navigating away from arena
                if (targetPageId !== 'arena' && battleInterval) {
                    clearInterval(battleInterval);
                    battleInterval = null; // Reset interval handle
                }

                document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
                document.querySelectorAll('.nav-link').forEach(navLink => navLink.classList.remove('active'));

                // Set initial state for ALL animatable elements on the newly activated page
                // This is crucial to ensure they start hidden before their ScrollTrigger animates them.
                const activePage = document.getElementById(targetPageId);
                activePage.classList.add('active'); // Activate the new page
                
                // Set initial opacity and transform for elements on the activated page
                gsap.set(activePage.querySelectorAll('.section-animate-in, .text-animate-in'), { opacity: 0, y: 40 });
                gsap.set(activePage.querySelectorAll('.feature-item'), { opacity: 0, scale: 0.8 });
                gsap.set(activePage.querySelectorAll('.roadmap-phase'), { opacity: 0, x: -50 });

                e.target.classList.add('active');

                // Page-specific render logic
                if (targetPageId === 'shop') {
                    renderShop();
                } else if (targetPageId === 'my-deck') {
                    renderMyDeck();
                } else if (targetPageId === 'arena') {
                    renderArenaCardSelection();
                } else if (targetPageId === 'leaderboard') {
                    renderLeaderboard();
                } else if (targetPageId === 'token') {
                    renderTokenPage();
                } else if (targetPageId === 'docs') {
                    renderDocsPage();
                }

                // Re-trigger animations using GSAP and ScrollTrigger for the *active* page
                // These are set up to trigger on scroll when they enter the viewport
                if (targetPageId === 'home') {
                    // Hero section animations (not scroll triggered, but always run on home load)
                    gsap.fromTo("#hero-title", { opacity: 0, y: 50 }, { opacity: 1, y: 0, duration: 1, ease: "power3.out", delay: 0.2 });
                    gsap.fromTo("#hero-subtitle", { opacity: 0, y: 50 }, { opacity: 1, y: 0, duration: 1, ease: "power3.out", delay: 0.5 });
                    gsap.fromTo(".hero-actions button", { opacity: 0, y: 30 }, { opacity: 1, y: 0, duration: 0.8, ease: "power2.out", stagger: 0.2, delay: 0.8 });


                    // Re-enable ScrollTriggers for home page sections
                    ScrollTrigger.batch(".stats-section, .about-section, .roadmap-section", {
                        onEnter: batch => {
                            gsap.to(batch, { opacity: 1, y: 0, scale: 1, duration: 1.2, ease: "power3.out", stagger: 0.2 });
                            // Also animate text within these sections
                            batch.forEach(section => {
                                gsap.to(section.querySelectorAll('.text-animate-in'), {
                                    opacity: 1,
                                    y: 0,
                                    duration: 0.8,
                                    ease: "power2.out",
                                    stagger: 0.05,
                                    delay: 0.3 // Delay relative to section entering
                                });
                            });
                        },
                        start: "top 80%",
                        // markers: true, // For debugging
                    });
                    ScrollTrigger.batch(".feature-item", { // Separate batch for feature items if different animation
                        onEnter: batch => gsap.to(batch, { opacity: 1, scale: 1, x: 0, duration: 1, ease: "power3.out", stagger: 0.1 }),
                        start: "top 80%",
                        // markers: true,
                    });
                    ScrollTrigger.batch(".roadmap-phase", { // Separate batch for roadmap phases
                        onEnter: batch => gsap.to(batch, { opacity: 1, x: 0, duration: 1, ease: "power3.out", stagger: 0.1 }),
                        start: "top 80%",
                        // markers: true,
                    });

                } else {
                     // For non-home pages, animate sections on load
                    gsap.to(activePage.querySelectorAll('.section-animate-in'), {
                        opacity: 1,
                        y: 0,
                        scale: 1,
                        duration: 1,
                        ease: "power3.out",
                        stagger: 0.15,
                        onComplete: () => {
                             gsap.to(activePage.querySelectorAll('.text-animate-in'), {
                                opacity: 1,
                                y: 0,
                                duration: 0.8,
                                ease: "power2.out",
                                stagger: 0.05
                            });
                        }
                    });
                     gsap.to(activePage.querySelectorAll('.feature-item'), { opacity: 1, scale: 1, x: 0, duration: 1, ease: "power3.out", stagger: 0.1 });
                     gsap.to(activePage.querySelectorAll('.roadmap-phase'), { opacity: 1, x: 0, duration: 1, ease: "power3.out", stagger: 0.1 });
                }
                ScrollTrigger.refresh(); // Crucial to refresh ScrollTrigger after DOM changes/visibility changes
            });
        });
        
        // --- Custom Cursor Logic ---
        const customCursor = document.getElementById('custom-cursor');
        if (customCursor) {
            document.addEventListener('mousemove', (e) => {
                customCursor.style.left = `${e.clientX}px`;
                customCursor.style.top = `${e.clientY}px`;
            });
        }
        
        // --- Text Character Animation (Not used for hero anymore, but kept if needed elsewhere) ---
        function animateTextByChar(element) {
            if(!element) return;
            // Clear previous spans if any
            if (element.querySelectorAll('.char').length > 0) {
                const text = Array.from(element.querySelectorAll('.char')).map(span => span.textContent === '\u00A0' ? ' ' : span.textContent).join('');
                element.innerHTML = '';
                element.textContent = text;
            }

            const text = element.textContent;
            element.innerHTML = '';
            text.split('').forEach(char => {
                const span = document.createElement('span');
                span.className = 'char';
                span.textContent = char === ' ' ? '\u00A0' : char;
                element.appendChild(span);
            });
            // Initial state for GSAP
            gsap.set(element.querySelectorAll('.char'), { opacity: 0, y: 20, scale: 0.5 });
            gsap.to(element.querySelectorAll('.char'), {
                opacity: 1,
                y: 0,
                scale: 1,
                duration: 0.5,
                ease: "power3.out",
                stagger: 0.03
            });
        }

        // --- Hero Section Background Reactive Effects ---
        const homeHero = document.getElementById('homeHero');
        const homeHeroBackground = 'https://via.placeholder.com/1200x400/0f3460/e0e0e0?text=SOLBATTLES+ARENA';

        if (homeHero) {
            homeHero.style.backgroundImage = `linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('${homeHeroBackground}')`;
            homeHero.style.backgroundAttachment = 'fixed';
            homeHero.style.backgroundPosition = 'center 0';

            // Parallax effect on mouse move with GSAP
            homeHero.addEventListener('mousemove', (e) => {
                const rect = homeHero.getBoundingClientRect();
                const x = (e.clientX - rect.left) / rect.width; // 0 to 1
                const y = (e.clientY - rect.top) / rect.height; // 0 to 1

                const bgX = (x - 0.5) * 40; 
                const bgY = (y - 0.5) * 40; 
                
                gsap.to(homeHero, {
                    backgroundPosition: `calc(50% + ${bgX}px) calc(50% + ${bgY}px)`,
                    '--mouse-x': `${x * 100}%`,
                    '--mouse-y': `${y * 100}%`,
                    duration: 0.5,
                    ease: "power2.out"
                });
            });

            // GSAP Floating Card Animations
            const floatingCards = document.querySelectorAll('.floating-card');
            floatingCards.forEach((card, index) => {
                gsap.to(card, {
                    y: (index % 2 === 0 ? 1 : -1) * gsap.utils.random(10, 30), // Random vertical float
                    x: (index % 3 === 0 ? 1 : -1) * gsap.utils.random(5, 15),  // Random horizontal drift
                    rotation: gsap.utils.random(-10, 10), // Random slight rotation
                    scale: gsap.utils.random(0.9, 1.1), // Slight scale variation
                    duration: gsap.utils.random(8, 15), // Longer, varied durations
                    ease: "sine.inOut",
                    repeat: -1,
                    yoyo: true,
                    delay: index * 0.5 // Stagger initial animation
                });
            });
        }

        // --- Dynamic Counter for Stats Section ---
        function animateCount(element, target) {
            gsap.to(element, {
                duration: 2,
                innerText: target,
                roundProps: "innerText",
                ease: "power1.out",
                onUpdate: function() {
                    element.textContent = Math.floor(element.innerText).toLocaleString() + '+';
                }
            });
        }

        function handleStatsIntersection(entries, observer) {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    gsap.to(entry.target.querySelectorAll('.stat-item'), {
                        opacity: 1,
                        y: 0,
                        duration: 1,
                        ease: "power3.out",
                        stagger: 0.15,
                        onComplete: () => {
                            entry.target.querySelectorAll('.stat-item').forEach(item => {
                                const statValue = item.querySelector('.stat-value');
                                if (statValue) {
                                    const target = parseInt(statValue.dataset.target);
                                    animateCount(statValue, target);
                                }
                            });
                        }
                    });
                    observer.unobserve(entry.target);
                }
            });
        }

        const statsSection = document.querySelector('.stats-section');
        const statsObserver = new IntersectionObserver(handleStatsIntersection, {
            root: null,
            threshold: 0.3
        });
        
        // --- Initial Setup on Load ---
        document.addEventListener('DOMContentLoaded', () => {
            const loadingScreen = document.getElementById('loading-screen');
            loadingScreen.style.display = 'flex'; // Ensure loading screen is visible

            initializeOwnedCards();
            updateSLUGDisplay();

            const homePage = document.getElementById('home');
            homePage.classList.add('active'); // Immediately activate home page
            document.querySelector('.nav-link[data-page="home"]').classList.add('active');
            
            // Set initial state for ALL animatable elements *before* any animations or ScrollTriggers run
            // This is crucial. Elements must be visible in the DOM for ScrollTrigger to calculate positions.
            // But we want them to start hidden for animation.
            gsap.set('.section-animate-in, .text-animate-in', { opacity: 0, y: 40 });
            gsap.set('.feature-item', { opacity: 0, scale: 0.8 }); // Specific for feature items
            gsap.set('.roadmap-phase', { opacity: 0, x: -50 }); // Specific for roadmap phases

            // GSAP Animations for Hero Section (these are not ScrollTriggered, they run on initial load of home page)
            gsap.fromTo("#hero-title", { opacity: 0, y: 50 }, { opacity: 1, y: 0, duration: 1, ease: "power3.out", delay: 0.2 });
            gsap.fromTo("#hero-subtitle", { opacity: 0, y: 50 }, { opacity: 1, y: 0, duration: 1, ease: "power3.out", delay: 0.5 });
            gsap.fromTo(".hero-actions button", { opacity: 0, y: 30 }, { opacity: 1, y: 0, duration: 0.8, ease: "power2.out", stagger: 0.2, delay: 0.8 });


            // Setup ScrollTrigger for other sections on homepage
            // These will now trigger as they come into view.
            ScrollTrigger.batch(".stats-section, .about-section, .roadmap-section", {
                onEnter: batch => {
                    gsap.to(batch, { opacity: 1, y: 0, scale: 1, duration: 1.2, ease: "power3.out", stagger: 0.2 });
                    // Also animate text within these sections
                    batch.forEach(section => {
                        gsap.to(section.querySelectorAll('.text-animate-in'), {
                            opacity: 1,
                            y: 0,
                            duration: 0.8,
                            ease: "power2.out",
                            stagger: 0.05,
                            delay: 0.3 // Delay relative to section entering
                        });
                    });
                },
                start: "top 80%",
                // markers: true, // For debugging
            });
            ScrollTrigger.batch(".feature-item", { // Separate batch for feature items if different animation
                onEnter: batch => gsap.to(batch, { opacity: 1, scale: 1, x: 0, duration: 1, ease: "power3.out", stagger: 0.1 }),
                start: "top 80%",
                // markers: true,
            });
            ScrollTrigger.batch(".roadmap-phase", { // Separate batch for roadmap phases
                onEnter: batch => gsap.to(batch, { opacity: 1, x: 0, duration: 1, ease: "power3.out", stagger: 0.1 }),
                start: "top 80%",
                // markers: true,
            });


            // Initial observation for stats section if it's in view
            if (statsSection) {
                statsObserver.observe(statsSection);
            }

            // Remove loading screen after a delay
            setTimeout(() => {
                loadingScreen.classList.add('fade-out');
                loadingScreen.addEventListener('transitionend', () => {
                    loadingScreen.style.display = 'none';
                    ScrollTrigger.refresh(); // Important: Refresh after DOM changes/visibility changes
                }, { once: true });
            }, 2500); // Wait for initial hero animations to start

            // Event listeners for navigation and other buttons (unchanged)
            document.getElementById('heroConnectWalletBtn').addEventListener('click', () => {
                document.getElementById('connectWalletBtn').click();
            });

            document.getElementById('heroLearnMoreBtn').addEventListener('click', () => {
                document.querySelector('.nav-link[data-page="docs"]').click();
            });

            document.getElementById('aboutCTA').addEventListener('click', () => {
                document.querySelector('.nav-link[data-page="my-deck"]').click();
            });
        });
    </script>
</body>
</html>
